<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iron Pulse | Gym Motivation Hub</title>
    <meta name="theme-color" content="#040405" />
    
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-192.png">
    <meta name="theme-color" content="#000000">
    
    <!-- iOS support -->
    <link rel="apple-touch-icon" href="icons/icon-512.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">


    <style>
        /* =========================
       1) ROOT + GLOBAL RESET
       ========================= */
       html, body {
            overflow-x: hidden;
}

        :root {
            --bg-dark: #040405;
            --bg-panel: #101219;
            --text-primary: #f5f7ff;
            --text-muted: rgba(245, 247, 255, 0.7);
            --accent: #ff512f;
            --accent-2: #dd2476;
            --accent-yellow: #f6c343;
            --card-border: rgba(255, 255, 255, 0.08);
            --glass: rgba(255, 255, 255, 0.05);
        }
    
        * {
            box-sizing: border-box;
        }
    
        body {
            margin: 0;
            font-family: "Space Grotesk", sans-serif;
            color: var(--text-primary);
            background: radial-gradient(circle at top, rgba(255, 81, 47, 0.1), transparent 45%),
                radial-gradient(circle at 20% 20%, rgba(221, 36, 118, 0.25), transparent 35%),
                var(--bg-dark);
            min-height: 100vh;
            line-height: 1.6;
        }
    
        a {
            color: inherit;
            text-decoration: none;
        }
    
        /* Screens â€“ JS controls which is visible */
        #screen-daily {
            display: none;
            /* first-time visitors see setup */
        }
    
        /* =========================
       2) LAYOUT: HEADER / NAV
       ========================= */
        header {
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(4, 4, 5, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
        }
    
        nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem clamp(1rem, 4vw, 3rem);
        }
    
        .logo {
            font-weight: 700;
            letter-spacing: 1px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }
    
        .logo span {
            color: var(--accent-yellow);
            font-size: 1.4rem;
        }
    
        .nav-links {
            display: flex;
            gap: 1.25rem;
            font-size: 0.95rem;
        }
    
        .nav-links a {
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.78rem;
        }
    
        /* Right-side nav actions: Setup + Start Today */
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
    
        .nav-actions .btn {
            padding: 0.55rem 1.25rem;
            font-size: 0.85rem;
        }
    
        /* =========================
       3) BUTTONS / CONTROLS
       ========================= */
        .btn {
            border: none;
            padding: 0.85rem 1.75rem;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 999px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
    
        .btn-primary {
            background-image: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: #fff;
            box-shadow: 0 20px 40px rgba(255, 81, 47, 0.3);
        }
    
        .btn-outline {
            border: 1px solid var(--card-border);
            color: var(--text-muted);
            background: transparent;
        }
    
        .btn:hover {
            transform: translateY(-3px);
        }
    
        /* Weekly goal day pills (interactive â€“ on daily screen) */
        .day-pill {
            border: 1px solid var(--card-border);
            background: transparent;
            color: var(--text-muted);
            padding: 0.5rem 1rem;
            border-radius: 999px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
        }
    
        .day-pill:hover {
            transform: translateY(-1px);
            border-color: var(--accent);
        }
    
        .day-pill.active {
            background-image: linear-gradient(135deg, var(--accent), var(--accent-2));
            color: #fff;
            border-color: transparent;
        }
    
        /* Weekly goal preview pills (visual-only â€“ on setup screen) */
        .day-pill-preview {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            border: 1px solid var(--card-border);
            font-size: 0.85rem;
            color: var(--text-muted);
            opacity: 0.85;
            pointer-events: none;
            /* non-interactive */
        }

        .day-pill[disabled] {
            opacity: 0.45;
            cursor: not-allowed;
            filter: grayscale(0.3);
}

    
        /* Bottom bar CTA (mobile only) */
        .bottom-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 0.5rem 1rem;
            background: rgba(4, 4, 5, 0.96);
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: center;
            z-index: 20;
        }
    
        .bottom-bar-btn {
            width: 100%;
            max-width: 480px;
            justify-content: center;
        }
    
        /* Hide bottom bar on larger screens */
        @media (min-width: 769px) {
            .bottom-bar {
                display: none;
            }
        }
    
        /* =========================
       4) MAIN LAYOUT
       ========================= */
        main {
            padding: clamp(2rem, 5vw, 4rem) clamp(1rem, 5vw, 4rem) 6rem;
        }
    
        /* Hero container */
        .hero {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 3rem;
            align-items: center;
            padding: clamp(2rem, 5vw, 4rem);
            border-radius: 2rem;
            background: linear-gradient(145deg, rgba(255, 81, 47, 0.1), rgba(4, 4, 5, 0.9));
            border: 1px solid var(--card-border);
        }
    
        .hero h1 {
            font-size: clamp(2.3rem, 6vw, 3.8rem);
            line-height: 1.1;
            margin-bottom: 1rem;
        }
    
        .hero p {
            color: var(--text-muted);
            max-width: 480px;
        }
    
        /* Setup-specific hero spacing */
        #screen-setup .hero {
            margin-bottom: 2.5rem;
        }
    
        #screen-setup .hero>div {
            max-width: 720px;
        }
    
        #screen-setup .hero p {
            margin-bottom: 0.75rem;
        }
    
        /* Stats row (if used) */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin: 2.5rem 0;
        }
    
        .stat-card {
            padding: 1.25rem;
            border-radius: 1rem;
            background: var(--bg-panel);
            border: 1px solid var(--card-border);
            text-align: center;
        }
    
        .stat-card strong {
            display: block;
            font-size: 2rem;
            margin-bottom: 0.25rem;
            color: var(--accent-yellow);
        }
    
        /* Right hero panel (used on daily screen) */
        .hero-panel {
            background: var(--bg-panel);
            border-radius: 1.5rem;
            padding: 2rem;
            border: 1px solid var(--card-border);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.35);
        }
    
        .hero-panel .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            border-radius: 999px;
            padding: 0.35rem 1rem;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(255, 255, 255, 0.08);
            margin-bottom: 1rem;
        }
    
        /* Sections */
        .section {
            margin-top: clamp(3rem, 7vw, 5rem);
        }
    
        /* Slightly tighter spacing for setup sections */
        #screen-setup .section {
            margin-top: 2.75rem;
        }
    
        .section-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
    
        .section-head h2 {
            margin: 0;
            font-size: clamp(1.6rem, 4vw, 2.45rem);
        }
    .finisher-head {
    align-items: baseline;
    gap: 0.5rem;
}

.finisher-subcopy {
    font-size: 0.85rem;
    color: var(--text-muted);
    max-width: 420px;
}

/* On mobile, stack nicely */
@media (max-width: 768px) {
    .finisher-head {
        flex-direction: column;
        align-items: flex-start;
    }

    .finisher-subcopy {
        max-width: 100%;
    }
}

        /* Weekly goal + install spacing */
        #weekly-goal .workout-card,
        #install .workout-card {
            margin-top: 1rem;
        }
    
        /* Generic grid helper */
        .grid {
            display: grid;
            gap: 1.5rem;
        }
    
        @media (min-width: 768px) {
            .grid-3 {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
    
        /* =========================
       5) CARDS / COMPONENTS
       ========================= */
        .workout-card {
            background: var(--bg-panel);
            border-radius: 1.5rem;
            padding: 1.75rem;
            border: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
    
        .workout-card h3 {
            margin: 0;
        }
    
        .workout-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
            color: var(--text-muted);
            font-size: 0.95rem;
        }
    
        /* Intro explainer cards on setup screen */
        .intro-grid {
            display: grid;
            margin-top: 2rem;
            gap: 1.25rem;
        }
    
        @media (min-width: 768px) {
            .intro-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
    
        .intro-card {
            min-height: 140px;
            margin: 0;
            opacity: 0;
            transform: translateY(12px);
            animation: fadeUp 4s ease forwards;
        }
    
        /* Fade-up animation for intro cards */
        @keyframes fadeUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    
        /* Title + description inside cards */
        .card-title {
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-yellow);
            font-size: 1rem;
        }
    
        .card-desc {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 0.75rem;
            line-height: 1.45;
        }
    
        /* Motivation board / quote card (daily screen) */
        .motivation-board {
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 1.5rem;
        }
    
        .motivation-card {
            padding: 1.5rem;
            border-radius: 1.25rem;
            border: 1px solid var(--card-border);
            background: var(--glass);
            min-height: 220px;
            display: flex;
            flex-direction: column;
        }
    
        .quote {
            font-size: 1.1rem;
            margin: 1rem 0 0.5rem;
        }
    
        .range-wrapper {
            margin-top: auto;
        }
    
        /* Input range (intensity slider) */
        input[type="range"] {
            width: 100%;
            accent-color: var(--accent);
        }
    

/* Week 1 */
.emblem-weekly-1::before {
    background: radial-gradient(circle, rgba(255,120,80,0.18), rgba(255,80,60,0.05));
    opacity: 0.6;
    filter: blur(10px);
}

/* Week 2 */
.emblem-weekly-2::before {
    background: radial-gradient(circle, rgba(255,150,100,0.22), rgba(255,80,50,0.07));
    opacity: 0.75;
    filter: blur(16px);
}

/* Week 3 */
.emblem-weekly-3::before {
    background: radial-gradient(circle, rgba(255,180,120,0.26), rgba(255,80,40,0.09));
    opacity: 0.9;
    filter: blur(22px);
}

@keyframes emblem-shimmer {
    0% { filter: blur(12px) brightness(1); }
    50% { filter: blur(18px) brightness(1.4); }
    100% { filter: blur(12px) brightness(1); }
}

/* Month 1 */
.emblem-monthly-1::before {
    background: radial-gradient(circle, rgba(255,200,80,0.32), rgba(255,120,40,0.12));
    opacity: 1;
    animation: emblem-shimmer 4s ease-in-out infinite;
}

/* Month 2 */
.emblem-monthly-2::before {
    background: radial-gradient(circle, rgba(255,210,90,0.36), rgba(255,120,30,0.14));
    opacity: 1;
    animation: emblem-shimmer 3.4s ease-in-out infinite;
}

/* Month 3 */
.emblem-monthly-3::before {
    background: radial-gradient(circle, rgba(255,220,90,0.40), rgba(255,110,20,0.16));
    opacity: 1;
    animation: emblem-shimmer 3s ease-in-out infinite;
}
@keyframes emblem-quarter-pulse {
    0%   { filter: blur(20px) brightness(1.1); }
    50%  { filter: blur(26px) brightness(1.55); }
    100% { filter: blur(20px) brightness(1.1); }
}

/* Quarter 1 */
.emblem-quarterly-1::before {
    background: radial-gradient(circle, rgba(255,160,50,0.40), rgba(255,80,20,0.12));
    opacity: 1;
    animation: emblem-quarter-pulse 2.4s ease-in-out infinite;
}

/* Quarter 2 */
.emblem-quarterly-2::before {
    background: radial-gradient(circle, rgba(255,180,70,0.46), rgba(255,80,10,0.16));
    opacity: 1;
    animation: emblem-quarter-pulse 2s ease-in-out infinite;
}

/* Quarter 3 */
.emblem-quarterly-3::before {
    background: radial-gradient(circle, rgba(255,200,80,0.52), rgba(255,70,0,0.18));
    opacity: 1;
    animation: emblem-quarter-pulse 1.7s ease-in-out infinite;
}
@keyframes emblem-annual-burn {
    0%   { filter: blur(24px) brightness(1); transform: scale(1); }
    50%  { filter: blur(32px) brightness(1.7); transform: scale(1.03); }
    100% { filter: blur(24px) brightness(1); transform: scale(1); }
}

.emblem-annual-1::before {
    background: radial-gradient(circle, rgba(255,220,90,0.65), rgba(255,100,0,0.22));
    opacity: 1;
    animation: emblem-annual-burn 1.8s ease-in-out infinite;
}

.emblem-annual-2::before {
    background: radial-gradient(circle, rgba(255,240,110,0.75), rgba(255,80,0,0.28));
    opacity: 1;
    animation: emblem-annual-burn 1.5s ease-in-out infinite;
}
@keyframes emblem-legendary-flare {
    0%   { filter: blur(28px) brightness(1) hue-rotate(0deg); }
    50%  { filter: blur(40px) brightness(2) hue-rotate(25deg); }
    100% { filter: blur(28px) brightness(1) hue-rotate(0deg); }
}

.emblem-legendary-1::before {
    background:
        radial-gradient(circle, rgba(255,255,255,0.85), rgba(255,120,0,0.35)),
        radial-gradient(circle, rgba(255,80,0,0.45), rgba(120,0,0,0.20));
    opacity: 1;
    animation: emblem-legendary-flare 1.2s ease-in-out infinite;
}
/* DEBUG: make Legendary impossible to miss */
.emblem-legendary-1 .streak-bg-layer {
    background-image:
        repeating-linear-gradient(
            45deg,
            rgba(255, 255, 255, 0.3),
            rgba(255, 255, 255, 0.3) 4px,
            rgba(255, 120, 0, 0.9) 4px,
            rgba(255, 120, 0, 0.9) 8px
        ),
        radial-gradient(circle at center,
            rgba(0, 0, 0, 0.75) 0%,
            rgba(0, 0, 0, 0.5) 40%,
            transparent 70%);
    background-size: 40px 40px, auto;
}

/* Power-up shell (scale + glow) */
@keyframes streakPowerShell {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(255, 120, 80, 0.0);
    }
    40% {
        transform: scale(1.03);
        box-shadow: 0 0 42px 0 rgba(255, 120, 80, 0.9);
    }
    80% {
        transform: scale(1.01);
        box-shadow: 0 0 26px 0 rgba(255, 120, 80, 0.6);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 16px 0 rgba(255, 120, 80, 0.3);
    }
}

/* Radiating energy arcs */
@keyframes streakPowerRays {
    0% {
        transform: scale(0.9) rotate(0deg);
        opacity: 0;
    }
    30% {
        opacity: 1;
    }
    100% {
        transform: scale(1.18) rotate(40deg);
        opacity: 0;
    }
}


.streak-emblem-wrapper {
    flex-shrink: 0;
}

.streak-emblem.rankup-emblem-preview {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.9));
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 0 18px rgba(255, 120, 80, 0.7);
}
/* Base Iron Plate */
.streak-emblem {
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 0 12px rgba(0, 0, 0, 0.8);
    overflow: hidden;
}

/* 1â€“3 weeks: dull steel plate */
.streak-emblem.emblem-weekly-1,
.streak-emblem.emblem-weekly-2,
.streak-emblem.emblem-weekly-3 {
    background:
        radial-gradient(circle at 30% 15%, rgba(255,255,255,0.18), rgba(40,40,48,1)),
        linear-gradient(145deg, #121319, #050509);
}

/* 1â€“3 months: reinforced shield, brighter rim */
.streak-emblem.emblem-monthly-1,
.streak-emblem.emblem-monthly-2,
.streak-emblem.emblem-monthly-3 {
    background:
        radial-gradient(circle at 30% 15%, rgba(255,255,255,0.22), rgba(40,40,48,1)),
        linear-gradient(145deg, #20222e, #0a0b10);
    box-shadow:
        0 0 14px rgba(255, 180, 120, 0.6),
        0 0 24px rgba(0, 0, 0, 0.8);
}

/* 4â€“9 months: reaper-ish aggressive metal */
.streak-emblem.emblem-quarterly-1,
.streak-emblem.emblem-quarterly-2,
.streak-emblem.emblem-quarterly-3 {
    background:
        radial-gradient(circle at 30% 15%, rgba(255,255,255,0.24), rgba(30,30,40,1)),
        linear-gradient(150deg, #3b1d1f, #060309);
    box-shadow:
        0 0 18px rgba(255, 120, 80, 0.8),
        0 0 30px rgba(0, 0, 0, 0.9);
}

/* 1â€“2 years: molten skull shield */
.streak-emblem.emblem-annual-1,
.streak-emblem.emblem-annual-2 {
    background:
        radial-gradient(circle at 25% 20%, rgba(255,255,255,0.3), rgba(40,10,10,1)),
        linear-gradient(150deg, #5b1b16, #0a0202);
    box-shadow:
        0 0 20px rgba(255, 160, 90, 0.9),
        0 0 36px rgba(0, 0, 0, 1);
}

/* 2+ years: legendary â€“ cracked lava skull */
.streak-emblem.emblem-legendary-1,
.streak-emblem.emblem-legendary-2,
.streak-emblem.emblem-legendary-3 {
    background:
        radial-gradient(circle at 25% 20%, rgba(255,255,255,0.36), rgba(50,10,0,1)),
        linear-gradient(140deg, #7a1300, #ff6a00, #f6c343);
    box-shadow:
        0 0 26px rgba(255, 200, 120, 1),
        0 0 50px rgba(255, 80, 0, 0.9);
}


.streak-emblem-icon {
    font-size: 1.4rem;
    position: relative;
    z-index: 1;
}

.streak-banner.streak-powerup {
    animation: streakPowerShell 0.8s ease-out;
    position: relative;
}

.streak-banner.streak-powerup::after {
    content: "";
    position: absolute;
    inset: -12px;
    border-radius: 999px;
    background:
        conic-gradient(
            from 0deg,
            rgba(255, 255, 255, 0.22),
            rgba(255, 140, 80, 0.6),
            rgba(255, 80, 40, 0.0),
            rgba(255, 255, 255, 0.22)
        );
    mix-blend-mode: screen;
    pointer-events: none;
    animation: streakPowerRays 0.9s ease-out forwards;
    z-index: -1;
}
@keyframes rankOverlayFadeIn {
    0% {
        opacity: 0;
        transform: translateY(20px) scale(0.96);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes rankOverlayGlowSweep {
    0% {
        transform: translateX(-120%);
        opacity: 0;
    }
    30% {
        opacity: 0.45;
    }
    100% {
        transform: translateX(120%);
        opacity: 0;
    }
}

.rankup-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    background:
        radial-gradient(circle at top, rgba(255, 120, 60, 0.2), transparent),
        rgba(0, 0, 0, 0.88);
    backdrop-filter: blur(4px);
    animation: rankOverlayFadeIn 0.25s ease-out;
}

.rankup-inner {
    position: relative;
    max-width: 380px;
    width: 100%;
    padding: 1.75rem 1.5rem 1.5rem;
    border-radius: 18px;
    background: linear-gradient(
        145deg,
        rgba(15, 15, 20, 0.96),
        rgba(24, 19, 18, 0.98)
    );
    border: 1px solid rgba(255, 180, 120, 0.2);
    box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.85),
        0 0 40px rgba(255, 120, 80, 0.4);
    text-align: center;
    overflow: hidden;
}

/* moving light sweep inside the card */
.rankup-inner::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(
        120deg,
        transparent,
        rgba(255, 255, 255, 0.16),
        transparent
    );
    opacity: 0;
    pointer-events: none;
    animation: rankOverlayGlowSweep 1.6s ease-out forwards;
}

.rankup-emblem-preview {
    width: 88px;
    height: 88px;
    margin: 0 auto 1rem;
    border-radius: 26px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.08), rgba(0, 0, 0, 0.9));
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 0 32px rgba(255, 120, 80, 0.7);
}

/* we reuse the emblem aura classes here too */
.rankup-emblem-preview.emblem-weekly-1::before,
.rankup-emblem-preview.emblem-weekly-2::before,
.rankup-emblem-preview.emblem-weekly-3::before,
.rankup-emblem-preview.emblem-monthly-1::before,
.rankup-emblem-preview.emblem-monthly-2::before,
.rankup-emblem-preview.emblem-monthly-3::before,
.rankup-emblem-preview.emblem-quarterly-1::before,
.rankup-emblem-preview.emblem-quarterly-2::before,
.rankup-emblem-preview.emblem-quarterly-3::before,
.rankup-emblem-preview.emblem-annual-1::before,
.rankup-emblem-preview.emblem-annual-2::before,
.rankup-emblem-preview.emblem-legendary-1::before {
    content: "";
    position: absolute;
    inset: -6px;
    border-radius: inherit;
    z-index: -1;
}

/* reuse your existing emblem gradients by classnames:
   .emblem-weekly-1::before, etc. will also apply here */

.rankup-icon {
    font-size: 2.2rem;
    position: relative;
    z-index: 1;
}

.rankup-inner h2 {
    font-size: 1.35rem;
    margin-bottom: 0.5rem;
    color: var(--text-primary, #fff);
}

.rankup-inner p {
    font-size: 0.98rem;
    margin-bottom: 1.25rem;
    color: var(--text-muted, #cfcfd6);
}

/* Base streak banner */
/* Base streak banner */
.streak-banner {
    position: relative;
    margin-bottom: 1rem;
    padding: 0.75rem 1rem;
    border-radius: 18px;
    background: linear-gradient(135deg, rgba(255, 81, 47, 0.18), rgba(246, 195, 67, 0.12));
    border: 1px solid var(--card-border);
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    color: var(--text-primary);
    overflow: hidden;          /* âœ… keep FX inside card */
    --emblem-strength: 0;
}

/* ðŸ”¥ Make sure all â€œrealâ€ content sits above the FX */
.streak-banner > *:not(.streak-bg-layer) {
    position: relative;
    z-index: 1;
}

/* One background layer that we re-skin per tier */
.streak-bg-layer {
    position: absolute;
    inset: 0;
    z-index: 0;                /* âœ… above banner background, below content */
    pointer-events: none;

    /* Darker in the center so text stays readable */
    background:
        radial-gradient(
            circle at center,
            rgba(0, 0, 0, 0.65) 0%,
            rgba(0, 0, 0, 0.35) 40%,
            transparent 70%
        );
    mix-blend-mode: screen;
}


/* keep these helpers from before */
.streak-banner-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

#streak-text {
    white-space: normal;
    flex: 1;
}

.streak-subline {
    opacity: 0.9;
    font-size: 0.9em;
}

.streak-banner span {
    font-weight: 500;
}

/* Layout rows inside the banner */
.streak-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
}

/* Top row: keep chips on one line on larger screens, allow wrap on small */
.streak-row-top {
    flex-wrap: wrap;
}
.streak-pill-emblem {
    border-color: rgba(255, 255, 255, 0.35);
    color: #ffe8b0;
    background: rgba(0, 0, 0, 0.55);
}

/* Little stat chips for week + tokens */

.streak-pill {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    padding: 0.2rem 0.7rem;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    background: rgba(0, 0, 0, 0.35);
    color: rgba(255, 255, 255, 0.9);
    white-space: nowrap;
}

.streak-pill-secondary {
    border-color: rgba(246, 195, 67, 0.6);
    color: #f6c343;
}

/* Short progress text */
.streak-progress-label {
    font-size: 0.8rem;
    color: var(--text-muted, rgba(245, 247, 255, 0.7));
}

.streak-icon {
    font-size: 1.4rem;
    flex-shrink: 0;
}

.streak-body {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    flex: 1;
    min-width: 0;
}

.streak-progress {
    margin-top: 0.35rem;
    width: 100%;
    height: 0.4rem;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    overflow: hidden;
}

.streak-progress-fill {
    height: 100%;
    width: 0;
    border-radius: 999px;
    background: linear-gradient(90deg, #ff512f, #f6c343);
    transition: width 0.35s ease-out;
}


    
        .finisher-card.locked {
            opacity: 0.6;
            border-style: dashed;
        }
    
        .finisher-card:not(.locked) {
            opacity: 1;
            border-style: solid;
        }
    
        /* Stories (if you keep them later) */
        .stories {
            background: linear-gradient(120deg, rgba(255, 81, 47, 0.18), rgba(16, 18, 25, 0.95));
            padding: clamp(2rem, 4vw, 3rem);
            border-radius: 2rem;
            border: 1px solid var(--card-border);
        }
    
        .story {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
    
        .story-card {
            background: rgba(0, 0, 0, 0.35);
            padding: 1.5rem;
            border-radius: 1.25rem;
            border: 1px solid var(--card-border);
        }
    
        .story-card strong {
            color: var(--accent-yellow);
        }
    
        /* CTA card */
        .cta {
            margin-top: 4rem;
            padding: clamp(2.5rem, 5vw, 3.5rem);
            border-radius: 2rem;
            text-align: center;
            border: 1px solid var(--card-border);
            background: linear-gradient(145deg, rgba(16, 18, 25, 0.9), rgba(255, 81, 47, 0.12));
        }
    
        .cta h3 {
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            margin-bottom: 0.5rem;
        }
    
        /* =========================
       6) FOOTER
       ========================= */
        footer {
            padding: 2rem clamp(1rem, 5vw, 4rem) 3rem;
            text-align: center;
            color: var(--text-muted);
            border-top: 1px solid var(--card-border);
            background: rgba(0, 0, 0, 0.35);
        }
    
        /* =========================
       7) UTILITIES
       ========================= */
        .hidden {
            display: none;
        }
    
        /* Checked exercise styling in today's split */
        #exercise-list label {
            transition: transform 0.15s ease;
        }
    
        #exercise-list input[type="checkbox"]:checked+span {
            text-decoration: line-through;
            opacity: 0.7;
            transform: translateX(2px);
        }
    
        /* =========================
       8) RESPONSIVE (MOBILE)
       ========================= */
        @media (max-width: 768px) {
            body {
                line-height: 1.5;
            }
    
            main {
                padding: 1.5rem 1rem 3rem;
            }
    
            /* Nav stacks nicely */
            nav {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }
    
            .nav-links {
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
                gap: 0.75rem;
                font-size: 0.75rem;
            }
    
            /* Hero stacks into one column */
            .hero {
                grid-template-columns: 1fr;
                padding: 1.75rem 1.25rem;
                text-align: left;
            }
    
            .hero h1 {
                font-size: 1.9rem;
            }
    
            .hero p {
                max-width: 100%;
            }
    
            .stats {
                margin: 1.5rem 0;
            }
    
            /* Make buttons easier to tap */
            .hero .btn {
                width: 100%;
                justify-content: center;
            }
    
            /* Sections closer together on mobile */
            .section {
                margin-top: 2.25rem;
            }
    
            .section-head {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
    
            .workout-card,
            .motivation-card,
            .cta {
                padding: 1.5rem 1.25rem;
                border-radius: 1.25rem;
                margin-top: 0.5rem;
                margin-bottom: 0.5rem;
            }
    
            .quote {
                font-size: 1.25rem;
            }
        }
        .weight-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: 1.8rem; /* lines it up nicely under the checkbox text */
    margin-top: 0.25rem;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.weight-row input[type="number"] {
    width: 5rem;
    padding: 0.25rem 0.4rem;
    border-radius: 0.5rem;
    border: 1px solid var(--card-border);
    background: var(--bg-panel);
    color: var(--text-primary);
    font-size: 0.85rem;
}

/* --- Toast notifications --- */
.toast-container {
    position: fixed;
    left: 50%;
    bottom: 5rem;
    transform: translateX(-50%);
    z-index: 40;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: center;
}

.toast {
    background: rgba(16, 18, 25, 0.95);
    border-radius: 18px;
    padding: 0.6rem 1.1rem;
    border: 1px solid var(--card-border);
    font-size: 0.85rem;

    /* âœ… Allow wrapping + cap the width */
    white-space: normal;
    max-width: min(90vw, 320px);
    overflow-wrap: anywhere;

    /* Center text inside the pill */
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;

    animation: toast-in .8s ease-out forwards;
}



@keyframes toast-in {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes toast-out {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(6px);
    }
}


/* --- Daily completion halo on Today's Split card --- */
.day-complete-boost {
    position: relative;           /* so pseudo-elements can anchor */
    animation: animeBlast 1.6s ease-out;
    overflow: visible;            /* allow glow & ring to spill out */
}



@keyframes animeBlast {
    0% {
        transform: scale(0.97);
        box-shadow: 0 0 0 rgba(255, 90, 70, 0);
        filter: brightness(0.9);
    }

    /* Impact flash */
    12% {
        transform: scale(1.06);
        box-shadow:
            0 0 20px rgba(255, 90, 70, 0.7),
            0 0 40px rgba(255, 160, 90, 0.6),
            0 0 80px rgba(255, 220, 150, 0.45);
        filter: brightness(1.3);
    }

    /* Energy surge */
    30% {
        transform: scale(1.03) translateY(-2px);
        box-shadow:
            0 0 26px rgba(255, 100, 80, 0.7),
            0 0 70px rgba(255, 170, 100, 0.5),
            0 0 110px rgba(255, 240, 180, 0.3);
        filter: brightness(1.15);
    }

    /* Lingering aura */
    60% {
        transform: scale(1.01) translateY(-1px);
        box-shadow:
            0 0 18px rgba(255, 100, 80, 0.5),
            0 0 40px rgba(255, 170, 100, 0.35);
        filter: brightness(1.05);
    }

    /* Fade out */
    100% {
        transform: scale(1) translateY(0);
        box-shadow: 0 0 0 rgba(0, 0, 0, 0);
        filter: brightness(1);
    }
}
.day-complete-boost::before,
.day-complete-boost::after {
    content: "";
    position: absolute;
    inset: 0;              /* â¬… stay inside the card */
    border-radius: inherit;
    pointer-events: none;
}


/* Big expanding ring */
.day-complete-boost::before {
    border: 2px solid rgba(255, 180, 120, 0.9);
    box-shadow:
        0 0 16px rgba(255, 140, 90, 0.9),
        0 0 40px rgba(255, 210, 150, 0.7);
    opacity: 0;
    transform: scale(0.85);
    animation: animeRing 1.2s ease-out forwards;
}

/* Bright inner flash */
.day-complete-boost::after {
    background: radial-gradient(circle, rgba(255, 255, 255, 0.45), transparent 60%);
    opacity: 0;
    transform: scale(0.7);
    animation: animeFlash 0.45s ease-out forwards;
}

@keyframes animeRing {
    0% {
        opacity: 0.9;
        transform: scale(0.75);
    }
    60% {
        opacity: 0.45;
        transform: scale(1.15);
    }
    100% {
        opacity: 0;
        transform: scale(1.4);
    }
}

@keyframes animeFlash {
    0% {
        opacity: 0.95;
        transform: scale(0.7);
    }
    40% {
        opacity: 0.8;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(1.05);
    }
}







/* --- Finisher card micro-pop --- */
.finisher-celebrate {
    animation: finisher-pop 0.5s ease-out;
}

@keyframes finisher-pop {
    0% {
        transform: scale(1);
    }
    35% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

/* --- Weekly goal celebration overlay --- */
.weekly-overlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at top, rgba(255, 81, 47, 0.18), rgba(4, 4, 5, 0.96));
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    animation: overlay-in 0.35s ease-out forwards;
}

.weekly-overlay-card {
    padding: 1.75rem 2rem;
    border-radius: 1.5rem;
    background: rgba(4, 4, 5, 0.95);
    border: 1px solid var(--card-border);
    text-align: center;
    max-width: 320px;
}

.weekly-overlay-card h2 {
    margin: 0 0 0.5rem;
    font-size: 1.5rem;
}

.weekly-overlay-card p {
    margin: 0 0 1.25rem;
    color: var(--text-muted);
    font-size: 0.9rem;
}

@keyframes overlay-in {
    from {
        opacity: 0;
        transform: scale(0.96);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

.finisher-card.completed-pulse {
    box-shadow: 0 0 0 0 rgba(246, 195, 67, 0.7);
    animation: finisherPulse 0.6s ease-out;
}

@keyframes finisherPulse {
    0% {
        box-shadow: 0 0 0 0 rgba(246, 195, 67, 0.7);
    }
    100% {
        box-shadow: 0 0 0 16px rgba(246, 195, 67, 0);
    }
}

.streak-body {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.18rem;
}

#streak-text {
    white-space: normal;
    line-height: 1.3;
}

.finisher-card {
  padding: 1.25rem 1.4rem;
  border-radius: 1.5rem;
  background: var(--card-bg-strong, #050509);
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.finisher-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.finisher-title-block h3 {
  margin: 0;
  font-size: 1.1rem;
}

.finisher-title-block p {
  margin: 0.25rem 0 0;
  font-size: 0.9rem;
  opacity: 0.9;
}

.finisher-tag-pill {
  font-size: 0.75rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  padding: 0.25rem 0.6rem;
  border-radius: 999px;
  border: 1px solid rgba(246, 195, 67, 0.5);
  color: #f6c343;
  align-self: flex-start;
  white-space: nowrap;
}

.finisher-step {
  margin-top: 0.75rem;
}

.finisher-step-label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 0.35rem;
}

.finisher-chip-row {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.finisher-chip {
  border-radius: 999px;
  padding: 0.4rem 1.1rem;
  font-size: 0.9rem;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(255, 255, 255, 0.02);
  color: var(--text-primary, #fff);
}

.finisher-chip.btn-primary {
  border-color: transparent;
  background: linear-gradient(135deg, #ff4b4b, #f6c343);
  box-shadow: 0 0 18px rgba(255, 75, 75, 0.35);
}

.finisher-status-helper {
  margin-top: 0.9rem;
  font-size: 0.85rem;
  opacity: 0.9;
}

.finisher-actions {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;   /* â¬… centers the content */
    text-align: center;    /* â¬… centers text inside */
    gap: 0.5rem;
}

.finisher-complete-message {
    font-size: 0.95rem;
    color: var(--accent-yellow);
    opacity: 0;
    animation: finisherMessageFade 0.4s ease-out forwards;
}

@keyframes finisherMessageFade {
    from { opacity: 0; transform: translateY(4px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* Continuous heartbeat aura (always on when streak is active) */
.streak-banner.streak-active::before {
    content: "";
    position: absolute;
    inset: -4px;
    border-radius: inherit;
    background:
        radial-gradient(circle at 0% 50%, rgba(255, 81, 47, 0.35), transparent 60%),
        radial-gradient(circle at 100% 50%, rgba(221, 36, 118, 0.35), transparent 60%);
    opacity: calc(0.25 + 0.6 * var(--emblem-strength));
    filter: blur(calc(6px + 10px * var(--emblem-strength)));
    pointer-events: none;
    z-index: -1;
    animation: streakAura 3.2s ease-in-out infinite;
}

/* Heartbeat-style pulsing */
@keyframes streakAura {
    0% {
        transform: translateY(0) scale(1);
        filter: blur(6px) brightness(1);
    }
    40% {
        transform: translateY(-1px) scale(1.01);
        filter: blur(10px) brightness(1.4);
    }
    100% {
        transform: translateY(0) scale(1);
        filter: blur(6px) brightness(1);
    }
}
@keyframes streakGlowSoft {
    0%   { filter: brightness(1) blur(6px); }
    50%  { filter: brightness(1.25) blur(9px); }
    100% { filter: brightness(1) blur(6px); }
}

.emblem-weekly-1 .streak-bg-layer,
.emblem-weekly-2 .streak-bg-layer,
.emblem-weekly-3 .streak-bg-layer {
    background-image:
        radial-gradient(circle at center,
            rgba(0, 0, 0, 0.65) 0%,
            rgba(0, 0, 0, 0.35) 40%,
            transparent 70%),
        radial-gradient(circle at 0% 50%, rgba(255, 120, 80, 0.30), transparent 60%),
        radial-gradient(circle at 100% 50%, rgba(246, 195, 67, 0.25), transparent 60%);
    animation: streakGlowSoft 6s ease-in-out infinite;
}
@keyframes streakGlitterDrift {
    0% {
        background-position:
            0 0,          /* center dimmer layer stays fixed */
            0 0,
            40px 30px,
            -60px 80px;
    }
    100% {
        background-position:
            0 0,
            80px 40px,
            -40px 110px,
            120px -40px;
    }
}

.emblem-monthly-1 .streak-bg-layer,
.emblem-monthly-2 .streak-bg-layer,
.emblem-monthly-3 .streak-bg-layer {
    background-image:
        radial-gradient(circle at center,
            rgba(0, 0, 0, 0.7) 0%,
            rgba(0, 0, 0, 0.4) 40%,
            transparent 70%),
        radial-gradient(circle at 20% 15%, rgba(255, 255, 255, 0.20), transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(255, 200, 120, 0.22), transparent 60%),
        radial-gradient(circle at 40% 95%, rgba(255, 150, 90, 0.18), transparent 60%);
    background-size:
        auto,
        90px 90px,
        130px 130px,
        100px 100px;
    animation: streakGlitterDrift 14s linear infinite;
}
@keyframes streakSparksSweep {
    0% {
        background-position:
            0 0,
            -120px 0,
            0 0,
            40px 80px;
    }
    100% {
        background-position:
            0 0,
            120px 0,   /* blue-ish electric band sweeps across */
            0 0,
            -40px -60px;
    }
}

.emblem-quarterly-1 .streak-bg-layer,
.emblem-quarterly-2 .streak-bg-layer,
.emblem-quarterly-3 .streak-bg-layer {
    background-image:
        radial-gradient(circle at center,
            rgba(0, 0, 0, 0.7) 0%,
            rgba(0, 0, 0, 0.45) 40%,
            transparent 70%),
        linear-gradient(120deg,
            transparent 0%,
            rgba(120, 200, 255, 0.35) 40%,
            rgba(0, 180, 255, 0.6) 50%,
            transparent 60%),
        radial-gradient(circle at 15% 80%, rgba(255, 180, 100, 0.25), transparent 65%),
        radial-gradient(circle at 90% 10%, rgba(255, 255, 255, 0.15), transparent 60%);
    background-size:
        auto,
        260px 260px,    /* big electric band */
        140px 140px,
        110px 110px;
    animation: streakSparksSweep 10s linear infinite;
}
@keyframes streakLavaFlow {
    0% {
        background-position:
            0 0,
            0 0,
            80px 0,
            -40px 40px;
    }
    100% {
        background-position:
            0 0,
            -200px 60px,
            -40px -20px,
            80px -40px;
    }
}

.emblem-annual-1 .streak-bg-layer,
.emblem-annual-2 .streak-bg-layer,
.emblem-legendary-1 .streak-bg-layer,
.emblem-legendary-2 .streak-bg-layer,
.emblem-legendary-3 .streak-bg-layer {
    background-image:
        radial-gradient(circle at center,
            rgba(0, 0, 0, 0.75) 0%,
            rgba(0, 0, 0, 0.5) 40%,
            transparent 70%),
        linear-gradient(130deg,
            rgba(120, 0, 0, 0.75),
            rgba(220, 80, 0, 0.9),
            rgba(255, 200, 80, 0.85)),
        radial-gradient(circle at 10% 90%, rgba(255, 230, 150, 0.35), transparent 65%),
        radial-gradient(circle at 95% 5%, rgba(255, 255, 255, 0.18), transparent 60%);
    background-size:
        auto,
        320px 320px,
        160px 160px,
        140px 140px;
    animation: streakLavaFlow 9s linear infinite;
}


/* Base: no reactive pattern unless emblem tier is high */
.streak-banner::after {
    content: "";
    position: absolute;
    inset: -2px;
    border-radius: inherit;
    pointer-events: none;
    opacity: 0;
    z-index: -1;
}

/* Monthly tier â€“ slow, subtle energy flow */
.streak-banner.emblem-monthly-1::after,
.streak-banner.emblem-monthly-2::after,
.streak-banner.emblem-monthly-3::after {
    opacity: 0.4;
    background:
        conic-gradient(
            from 0deg,
            rgba(255, 255, 255, 0.08),
            rgba(255, 160, 90, 0.18),
            rgba(255, 90, 60, 0.0),
            rgba(255, 255, 255, 0.08)
        );
    mix-blend-mode: screen;
    animation: reactiveCamoSlow 14s linear infinite;
}

/* Quarterly tier â€“ faster, more intense sweep */
.streak-banner.emblem-quarterly-1::after,
.streak-banner.emblem-quarterly-2::after,
.streak-banner.emblem-quarterly-3::after {
    opacity: 0.55;
    background:
        conic-gradient(
            from 0deg,
            rgba(255, 255, 255, 0.12),
            rgba(255, 190, 90, 0.3),
            rgba(255, 80, 40, 0.06),
            rgba(255, 255, 255, 0.12)
        );
    mix-blend-mode: screen;
    animation: reactiveCamoMedium 10s linear infinite;
}

/* Annual & Legendary â€“ wild reactive skin */
.streak-banner.emblem-annual-1::after,
.streak-banner.emblem-annual-2::after,
.streak-banner.emblem-legendary-1::after,
.streak-banner.emblem-legendary-2::after,
.streak-banner.emblem-legendary-3::after {
    opacity: 0.7;
    background:
        conic-gradient(
            from 0deg,
            rgba(255, 255, 255, 0.2),
            rgba(255, 230, 120, 0.45),
            rgba(255, 100, 40, 0.1),
            rgba(255, 255, 255, 0.2)
        );
    mix-blend-mode: screen;
    animation: reactiveCamoFast 7s linear infinite;
}


@keyframes reactiveCamoSlow {
    0%   { transform: rotate(0deg) scale(1); }
    100% { transform: rotate(360deg) scale(1); }
}

@keyframes reactiveCamoMedium {
    0%   { transform: rotate(0deg) scale(1.02); }
    100% { transform: rotate(360deg) scale(1.02); }
}

@keyframes reactiveCamoFast {
    0%   { transform: rotate(0deg) scale(1.05); }
    100% { transform: rotate(360deg) scale(1.05); }
}


/* Post-workout motivational overlay */
.postworkout-overlay {
    position: fixed;
    inset: 0;
    z-index: 60;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
    background:
        radial-gradient(circle at top, rgba(255, 81, 47, 0.2), transparent 55%),
        rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(4px);
}

.postworkout-card {
    max-width: 360px;
    width: 100%;
    padding: 1.5rem 1.75rem 1.3rem;
    border-radius: 1.25rem;
    background: rgba(4, 4, 5, 0.96);
    border: 1px solid rgba(255, 255, 255, 0.08);
    box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.85),
        0 0 18px rgba(255, 81, 47, 0.4);
    text-align: center;
}

.postworkout-card h2 {
    margin: 0 0 0.6rem;
    font-size: 1.3rem;
}

.postworkout-quote {
    margin: 0 0 0.4rem;
    font-size: 0.98rem;
}

.postworkout-hint {
    margin: 0 0 1rem;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.postworkout-actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

@media (min-width: 480px) {
    .postworkout-actions {
        flex-direction: row;
        justify-content: center;
    }

    .postworkout-actions .btn {
        min-width: 0;
        flex: 1;
    }
}

/* Brief glow when we scroll to the finisher card */
.finisher-focus {
    box-shadow:
        0 0 18px rgba(246, 195, 67, 0.6),
        0 0 34px rgba(255, 81, 47, 0.5);
    transition: box-shadow 0.3s ease;
}


/* Aura when streak is active */
/* Aura when streak is active */
.streak-banner.streak-active {
    box-shadow:
        0 0 calc(10px + 12px * var(--emblem-strength)) rgba(255, 81, 47, 0.6),
        0 0 calc(20px + 22px * var(--emblem-strength)) rgba(221, 36, 118, 0.55);
}



/* === Weekly Volume Card === */
.weekly-volume-card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

/* Layout: object on left, bar on right on desktop */
.volume-main {
    display: flex;
    align-items: center;
    gap: 1.25rem;
}

/* Stack nicely on mobile */
@media (max-width: 768px) {
    .volume-main {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* Object side */
.volume-object {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.35rem;
    min-width: 110px;
}

.volume-object-emoji {
    font-size: 2.3rem;
    line-height: 1;
    filter: drop-shadow(0 0 10px rgba(255, 140, 90, 0.4));
    transition: transform 0.25s ease, filter 0.25s ease;
}

.volume-object-label {
    font-size: 0.85rem;
    text-align: center;
    color: var(--text-muted, rgba(245, 247, 255, 0.7));
}

/* Bar side */
.volume-bar-block {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    width: 100%;
}

.volume-bar {
    position: relative;
    width: 100%;
    height: 0.55rem;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.08);
    overflow: hidden;
}

.volume-bar-fill {
    height: 100%;
    width: 0;
    border-radius: inherit;
    background: linear-gradient(90deg, #ff512f, #f6c343);
    box-shadow: 0 0 14px rgba(255, 150, 80, 0.7);
    transition: width 0.45s ease-out;
}

.volume-bar-caption {
    font-size: 0.85rem;
    color: var(--text-muted, rgba(245, 247, 255, 0.7));
}

/* === Level-up explosion effect === */
@keyframes volumeBarExplode {
    0% {
        transform: scaleX(1);
        box-shadow: 0 0 10px rgba(255, 160, 90, 0.7);
    }
    40% {
        transform: scaleX(1.04);
        box-shadow:
            0 0 20px rgba(255, 200, 120, 0.9),
            0 0 40px rgba(255, 120, 60, 0.7);
    }
    100% {
        transform: scaleX(1);
        box-shadow: 0 0 12px rgba(255, 160, 90, 0.6);
    }
}

@keyframes volumeEmojiPop {
    0%   { transform: scale(1) translateY(0); filter: drop-shadow(0 0 8px rgba(255, 140, 90, 0.5)); }
    30%  { transform: scale(1.18) translateY(-2px); filter: drop-shadow(0 0 20px rgba(255, 220, 150, 0.9)); }
    100% { transform: scale(1) translateY(0); filter: drop-shadow(0 0 10px rgba(255, 140, 90, 0.6)); }
}

.volume-levelup .volume-bar-fill {
    animation: volumeBarExplode 0.7s ease-out;
}

.volume-object-emoji.levelup-pop {
    animation: volumeEmojiPop 0.6s ease-out;
}

    </style>

</head>

<body>
    <header>
        <nav>
            <div class="logo">
                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px;">
                    <path
                        d="M12 21s-6.9-4.4-9.5-8.3C.8 9.7 2.2 5.8 5.4 4.3c2-.9 4.3-.2 5.6 1.4 1.3-1.6 3.6-2.3 5.6-1.4 3.2 1.5 4.6 5.4 2.9 8.4C18.9 16.6 12 21 12 21z" />
                    <polyline points="6 12 9 12 11 8 13 16 15 12 18 12" />
                </svg>
                Iron Pulse           
            </div>
            

            <div class="nav-actions">
                <button class="btn btn-outline" id="open-settings-btn">Setup</button>
                <button class="btn btn-primary" id="hero-cta">Start Today</button>
            </div>

        </nav>
    </header>

    <main>
        
    <div id="screen-setup">
        <!-- HERO / INTRO -->
        <section class="hero">
            <div>
                <p class="badge" style="letter-spacing:2px;">Daily Grind - No Excuses</p>
                <h1>Build strength, discipline, and a body you are proud of.</h1>
                <p>
                    Iron Pulse is your training partner. Follow structured workouts, track intensity,
                    and get the motivation you need to stay consistent, even when the weights feel heavy.
                </p>
    
                <div style="display:flex;gap:1rem;flex-wrap:wrap;margin-top:2rem;">
                    <button class="btn btn-primary" id="add-to-home-btn">
                        Add to Home Screen
                    </button>
    
                    <a class="btn btn-outline" href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank"
                        rel="noopener noreferrer">
                        Watch Trailer
                    </a>
                </div>
    
                <!-- EXPLAINER CARDS -->
                <div class="intro-grid" style="margin-top:2rem;">
                    <article class="workout-card intro-card">
                        <strong class="card-title">Weekly Focus</strong>
                        <p class="card-desc">
                            Choose how many days you want to train this week. Iron Pulse builds a plan to match your
                            schedule.
                        </p>
                    </article>
    
                    <article class="workout-card intro-card">
                        <strong class="card-title">Today's Split</strong>
                        <p class="card-desc">
                            Open the app each day to see a clear workout. Simple, structured, and easy to follow.
                        </p>
                    </article>
    
                    <article class="workout-card intro-card">
                        <strong class="card-title">Optional Finisher</strong>
                        <p class="card-desc">
                            Finish your workout strong. Complete your split to unlock a short, optional challenge when youâ€™ve still got something
                            left in the tank.
                        </p>
                    </article>
    
                    <article class="workout-card intro-card">
                        <strong class="card-title">Streaks + Rest Days</strong>
                        <p class="card-desc">
                            Track your consistency and earn Rest Tokens to stay motivated without burning out.
                        </p>
                    </article>
                </div>
            </div>
        </section>
    
        <!-- WEEKLY GOAL PREVIEW (VISUAL ONLY) -->
        <section class="section" id="weekly-goal">
            <div class="section-head">
                <h2>Weekly Training Goal</h2>
                <p style="color:var(--text-muted);max-width:520px;">
                    Decide how many days you're committing to this week. Iron Pulse measures success against that goal, not perfection.
                </p>
            </div>
    
            <article class="workout-card">
                <p style="margin-top:0;color:var(--text-muted);">
                    I'm aiming to train this many days this week:
                </p>
    
                <div class="weekly-goal-preview" style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem;">
                    <span class="day-pill-preview" data-days="3">3 days</span>
                    <span class="day-pill-preview" data-days="4">4 days</span>
                    <span class="day-pill-preview" data-days="5">5 days</span>
                    <span class="day-pill-preview" data-days="6">6 days</span>
                    <span class="day-pill-preview" data-days="7">7 days</span>
                </div>
            </article>
        </section>
    
        <!-- INSTALL INSTRUCTIONS -->
        <section class="section" id="install">
            <div class="section-head">
                <h2>Install Iron Pulse as an App</h2>
                <p style="color:var(--text-muted);max-width:520px;">
                    Add Iron Pulse to your home screen so it opens like a dedicated gym app before every session.
                </p>
            </div>
    
            <div class="grid">
                <article class="workout-card">
                    <h3>On Android (Chrome)</h3>
                    <ul>
                        <li>1. Open this page in Chrome.</li>
                        <li>2. Tap the menu button (â‹®) in the top-right.</li>
                        <li>3. Tap <strong>Add to Home screen</strong> or <strong>Install app</strong>.</li>
                        <li>4. Confirm, then open it from your home screen like any other app.</li>
                    </ul>
                </article>
    
                <article class="workout-card">
                    <h3>On iPhone (Safari)</h3>
                    <ul>
                        <li>1. Open this page in Safari.</li>
                        <li>2. Tap the <strong>Share</strong> button (square with arrow).</li>
                        <li>3. Scroll down and tap <strong>Add to Home Screen</strong>.</li>
                        <li>4. Name it â€œIron Pulseâ€ and tap <strong>Add</strong>.</li>
                    </ul>
                </article>
            </div>
        </section>
    </div>
  
        
<div id="screen-daily">
    <div id="streak-banner" class="streak-banner hidden">
            <div class="streak-bg-layer"></div>

        <div class="streak-emblem-wrapper">
            <div id="streak-emblem" class="rankup-emblem-preview streak-emblem">
                <span class="streak-emblem-icon">ðŸ”¥</span>
            </div>
        </div>
    
        <div class="streak-body">
            <!-- Top row: week + tokens -->
            <div class="streak-row streak-row-top">
                <span id="streak-week-label" class="streak-pill"></span>
                <span id="streak-token-label" class="streak-pill streak-pill-secondary"></span>
                <!-- ðŸ”¥ NEW: emblem label -->
                <span id="streak-emblem-label" class="streak-pill streak-pill-emblem hidden"></span>
            </div>

    
            <!-- Middle row: short progress text -->
            <div class="streak-row">
                <span id="streak-text" class="streak-progress-label"></span>
            </div>
    
            <!-- Progress bar -->
            <div class="streak-progress">
                <div class="streak-progress-fill" id="streak-progress-fill"></div>
            </div>
        </div>
    </div>


        <section class="section" id="weekly-focus-live">
        
            <article class="workout-card" id="weekly-focus-card">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <h3 style="margin:0;">Training Goal</h3>
                    <span id="weekly-focus-days-label" style="color:var(--accent-yellow);font-weight:600;">
                        <!-- JS fills this -->
                        4 days / week
                    </span>
                </div>
                <p id="weekly-focus-summary" style="color:var(--text-muted);margin:0.75rem 0 0;">
                    <!-- JS fills this -->
                    Aim to train 4 days this week. Rest is allowedâ€”consistency over perfection.
                </p>
                    <p id="weekly-progress-text" style="color:var(--text-muted);margin:0.35rem 0 0;font-size:0.9rem;">
                        <!-- JS will show: 0 of 4 sessions completed this week -->
                    </p>

            </article>
        </section>

        <section id="weekly-volume" class="section">
            <div class="section-head">
                <h2>This Weekâ€™s Volume</h2>
            </div>
        
            <div class="workout-card weekly-volume-card">
                <div class="volume-main">
                    <!-- Left side: object icon + label -->
                    <div class="volume-object">
                        <div id="volume-object-emoji" class="volume-object-emoji">ðŸš—</div>
                        <div id="volume-object-label" class="volume-object-label">
                            Small car
                        </div>
                    </div>
        
                    <!-- Right side: bar + caption -->
                    <div class="volume-bar-block">
                        <div class="volume-bar">
                            <div id="volume-bar-fill" class="volume-bar-fill"></div>
                        </div>
                        <div id="volume-bar-caption" class="volume-bar-caption">
                            Youâ€™ve moved 0 lbs so far â€” letâ€™s get that bar moving.
                        </div>
                    </div>
                </div>
            </div>
        </section>




    <div id="daily-main-content">
        <section class="section" id="split">
            <div class="section-head">
                <h2>Today's Split</h2>
            </div>
            




        
            <div class="workout-card">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                    <h3 id="split-name">Loading split...</h3>
                    <span id="split-days" style="color:var(--accent-yellow);font-weight:600;"></span>
                </div>
                <p id="split-description" style="color:var(--text-muted);margin:0 0 1rem 0;">
                    <!-- Filled by JavaScript -->
                </p>
                <ul id="exercise-list" style="list-style:none;padding:0;margin:0;color:var(--text-muted);">
                    <!-- Exercises with checkboxes will be injected here -->
                </ul>
            </div>
        </section>

        <section class="section" id="finisher">
            <div class="section-head finisher-head">
                <h2>Today's Finisher</h2>
                <span class="finisher-subcopy">
                    Optional extra work once today's main sets are done.
                </span>
            </div>

        
            <div id="finisher-card" class="finisher-card locked">
                <div class="finisher-header">
                    <div class="finisher-title-block">
                        <h3 id="finisher-title">Choose Your Finisher</h3>
                        <p id="finisher-description">
                            Pick a category and difficulty, then hit <strong>Complete</strong> to lock in today's finisher.
                        </p>
                    </div>

                    <span class="finisher-tag-pill" id="finisher-tag">LOCKED</span>
                </div>
            
                <!-- STEP 1: CATEGORY -->
                <div class="finisher-step">
                    <p class="finisher-step-label">1 Â· Pick a category</p>
                    <div class="finisher-chip-row">
                        <button type="button" class="btn finisher-chip finisher-cat-btn" data-category="conditioning">
                            Conditioning
                        </button>
                        <button type="button" class="btn finisher-chip finisher-cat-btn" data-category="bodyweight">
                            Bodyweight
                        </button>
                        <button type="button" class="btn finisher-chip finisher-cat-btn" data-category="pump">
                            Pump
                        </button>
                        <button type="button" class="btn finisher-chip finisher-cat-btn" data-category="recovery">
                            Recovery
                        </button>
                    </div>
                </div>
            
                <!-- STEP 2: DIFFICULTY -->
                <div class="finisher-step" id="finisher-difficulties">
                    <p class="finisher-step-label">2 Â· Pick difficulty</p>
                    <div class="finisher-chip-row">
                        <button type="button" class="btn finisher-chip finisher-diff-btn" data-difficulty="easy">
                            Easy
                        </button>
                        <button type="button" class="btn finisher-chip finisher-diff-btn" data-difficulty="standard">
                            Standard
                        </button>
                        <button type="button" class="btn finisher-chip finisher-diff-btn" data-difficulty="hard">
                            Hard
                        </button>
                    </div>
                </div>
            
                <!-- STATUS / EXPLANATION -->
                <p id="finisher-status" class="finisher-status-helper">
                    Select a category first, then choose difficulty to see your finisher and any
                    Rest Token reward.
                </p>
            
                <!-- ACTIONS -->
                <div class="finisher-actions">
                    <button id="finisher-do-btn" class="btn btn-primary btn-lg" disabled>
                        Mark Completed
                    </button>
                    <button id="finisher-skip-btn" class="btn btn-outline-light btn-lg" disabled>
                        Skip for Today
                    </button>
                </div>
            </div>


        </section>
    </div>


        <section class="section" id="weekly-goal-control">
            <article class="workout-card">
                <p style="color:var(--text-muted);margin:0 0 0.5rem;">
                    Choose your weekly training goal:
                </p>
                <div>
                    <button class="day-pill" data-days="3">3 Days</button>
                    <button class="day-pill" data-days="4">4 Days</button>
                    <button class="day-pill" data-days="5">5 Days</button>
                    <button class="day-pill" data-days="6">6 Days</button>
                    <button class="day-pill" data-days="7">7 Days</button>
                </div>
        
                <!-- ðŸ”¹ New: Commit button (hidden until a pill is chosen) -->
                <button class="btn btn-primary" id="commit-weekly-goal-btn"
                    style="margin-top:0.75rem;font-size:0.85rem;display:none;">
                    Commit!!!
                </button>
        
                <!-- ðŸ”¹ Existing: reset button (only shown after a goal exists) -->
                <button class="btn btn-outline" id="reset-weekly-goal-btn" style="margin-top:0.75rem;font-size:0.85rem;">
                    Reset Weekly Goal
                </button>
            </article>
        </section>

</div>
    </main>

    <footer>
        <p>Iron Pulse Collective - Built for the relentless - Train hard, recover harder.</p>
    </footer>
<div class="bottom-bar">
    <button class="btn btn-primary bottom-bar-btn" id="bottom-split-btn">
        Get Started
    </button>
</div>

<script>
    // =============================
    // 1) CONSTANTS & DATA
    // =============================
    const ONBOARDED_KEY = "ironPulseOnboarded";
    const LAST_SCREEN_KEY = "ironPulseLastScreen";
    const WEEKLY_GOAL_KEY = "ironPulseWeeklyGoalDays";
    const DEFAULT_WEEKLY_GOAL = 4;
    const WEEKLY_GOAL_LOCKED_KEY = "ironPulseWeeklyGoalLocked";
    const WORKOUTS_THIS_WEEK_KEY = "ironPulseWorkoutsCompleted";
    const ROTATION_INDEX_KEY = "ironPulseRotationIndex";
    const WEEK_ID_KEY = "ironPulseWeekId";
    const WEEKLY_STREAK_KEY = "ironPulseWeeklyStreak";
    const ROTATION_ORDER = [0, 1, 2, 3];
    const LAST_FINISHER_DATE_KEY = "ironPulseLastFinisherDate";
    const EXERCISE_WEIGHT_KEY = "ironPulseExerciseWeights";
    const LAST_EMBLEM_KEY = "ironPulseLastEmblem";
    const EMBLEM_TIER_KEY = "ironPulseEmblemTier";
    const VOLUME_TIER_KEY = "ironPulseVolumeTier";

    const VOLUME_OBJECTS = [
        { id: "start", threshold: 0, label: "Getting started", emoji: "âšª" },
        { id: "pack", threshold: 500, label: "Loaded backpack", emoji: "ðŸŽ’" },
        { id: "barbell", threshold: 2000, label: "Heavy barbell", emoji: "ðŸ‹ï¸" },
        { id: "car", threshold: 4000, label: "Small car", emoji: "ðŸš—" },
        { id: "truck", threshold: 8000, label: "Pickup truck", emoji: "ðŸšš" },
        { id: "bus", threshold: 20000, label: "City bus", emoji: "ðŸšŒ" },
        { id: "plane", threshold: 50000, label: "Small plane", emoji: "âœˆï¸" }
    ];

    // Short, neutral post-workout quotes (no attribution, no religion)
        const POST_WORKOUT_QUOTES = [
            "Small steps stack faster than you think.",
            "Every rep leaves a mark. Todayâ€™s is a good one.",
            "Progress doesnâ€™t shout. It whispers â€” until it doesnâ€™t.",
            "Youâ€™re closer than yesterday. Thatâ€™s the whole point.",
            "Momentum earned, not given.",
            "Consistency beats intensity over time.",
            "You showed up today. Thatâ€™s the hardest rep.",
            "You didnâ€™t wait to feel ready. You started.",
            "Strong days are built on days like this.",
            "Todayâ€™s work will quietly show up later.",
            "Youâ€™re building someone you can rely on.",
            "Discipline is a skill. Youâ€™re sharpening it.",
            "You kept a promise to yourself today.",
            "This session is one more vote for the person you want to be.",
            "Tired but done is still done.",
            "You didnâ€™t need perfect. You just needed effort.",
            "Progress is built on days just like this one.",
            "You finished. Most people never started.",
            "You turned intention into action.",
            "Your future self notices days like today.",
            "You moved your body. Your mind will thank you.",
            "Strong body, clearer head, better day.",
            "You traded comfort for progress. That adds up.",
            "Slow progress is still real progress.",
            "You proved you can show up when itâ€™s easier not to.",
            "Not every workout is loud. This one still counts.",
            "You didnâ€™t quit when it got boring. That matters.",
            "You handled the hard part. The rest of the day is lighter.",
            "You trained the muscle and the habit.",
            "You just raised your baseline a tiny bit.",
            "You stacked another brick on the wall.",
            "Youâ€™re quietly getting harder to stop.",
            "You pushed when no one was watching.",
            "Todayâ€™s effort is tomorrowâ€™s normal.",
            "Your body will remember this work.",
            "You moved more than your mood.",
            "You finished what you started. Thatâ€™s rare.",
            "You turned a plan into a result.",
            "Youâ€™ve got one more data point that says: I can do hard things.",
            "You just made the next workout easier to start.",
            "You didnâ€™t need perfect energy â€” just enough.",
            "You kept the streak of effort alive.",
            "You showed yourself you can follow through.",
            "Youâ€™re teaching your brain that youâ€™re serious.",
            "Your comfort zone shifted a little today.",
            "You chose long-term over short-term. Again.",
            "You did something for yourself that no one can take away.",
            "You turned pressure into progress.",
            "You used your time instead of losing it.",
            "You converted fatigue into confidence.",
            "You did the work. The results will catch up.",
            "You chose effort instead of excuses.",
            "You invested in strength you havenâ€™t even needed yet.",
            "You showed up for your goals, not your feelings.",
            "You pushed through the part where most people stop.",
            "You did something future you can be proud of.",
            "You traded 1 hour for a better week.",
            "You turned a regular day into a win.",
            "You didnâ€™t wait for motivation. You built it.",
            "You treated your health like a priority, not a slogan.",
            "You proved that low energy doesnâ€™t mean zero effort.",
            "You made progress that only you needed to understand.",
            "You added one more rep to your story.",
            "You fought the urge to skip. Thatâ€™s real strength.",
            "You showed up for yourself. Again.",
            "You picked effort over comfort. Thatâ€™s how things change.",
            "You finished the session. The hardest part is over.",
            "You chose growth when nobody asked you to.",
            "You practiced doing what you said you would do.",
            "You gave your future self a better starting point.",
            "You built proof that youâ€™re capable, not just hopeful.",
            "You didnâ€™t let the day decide for you.",
            "You chose discipline, not default.",
            "You created momentum that only you can feel.",
            "You made it through the reps your mind wanted to skip.",
            "You pushed a little past your comfort zone.",
            "You trained even if today wasnâ€™t perfect. Thatâ€™s power.",
            "You gave yourself one less reason to doubt tomorrow.",
            "You turned resistance into resilience.",
            "You added another quiet win to your week.",
            "You didnâ€™t coast. You contributed.",
            "You moved the needle, even if just a notch.",
            "You showed your limits they donâ€™t get the final say.",
            "You made the hard thing look normal.",
            "You turned â€œI shouldâ€ into â€œI did.â€",
            "You invested in strength youâ€™ll use outside the gym.",
            "You ended the session stronger than you started.",
            "You made today count in a way most people wonâ€™t.",
            "You took control of at least one part of your day.",
            "You proved that effort is always available.",
            "You made your next choice easier by finishing this one.",
            "You added weight to your confidence, not just the bar.",
            "You didnâ€™t wait for the right mood. You created it.",
            "You practiced being the type of person you respect.",
            "You kept your word when no one was checking.",
            "You made progress in private that will show in public.",
            "You turned doubt into data: you can do more than you think.",
            "You finished tired, not empty. Thatâ€™s a good line to live on.",
            "You repped out discipline one set at a time.",
            "You went from â€œmaybeâ€ to â€œdone.â€",
            "You added a chapter to your streak, not a footnote.",
            "You treated your goals like a job, not a wish.",
            "You gave yourself a win that canâ€™t be scrolled away.",
            "You walked out stronger than you walked in.",
            "You pushed through the voice that said â€œskip it.â€",
            "You made effort a habit, not an event.",
            "You did enough today to be proud. Thatâ€™s enough."
        ];


    function getRandomPostWorkoutQuote() {
            if (!POST_WORKOUT_QUOTES || POST_WORKOUT_QUOTES.length === 0) return "";
            const idx = Math.floor(Math.random() * POST_WORKOUT_QUOTES.length);
            return POST_WORKOUT_QUOTES[idx];
        }




    function getExerciseWeights() {
        try {
            const raw = localStorage.getItem(EXERCISE_WEIGHT_KEY);
            if (!raw) return {};
            const parsed = JSON.parse(raw);
            return parsed && typeof parsed === "object" ? parsed : {};
        } catch {
            return {};
        }
    }

    function saveExerciseWeights(map) {
        try {
            localStorage.setItem(EXERCISE_WEIGHT_KEY, JSON.stringify(map));
        } catch {
            // fail silently if storage is full, etc.
        }
    }

        // === Rest tokens ===
    const REST_TOKENS_KEY = "ironPulseRestTokens";
    const REST_TOKEN_PROGRESS_KEY = "ironPulseRestTokenProgress";
    const MAX_REST_TOKENS = 5; // you can change to 3â€“5 later if you want


    // === Weekly weight (by day, 0 = Sunday ... 6 = Saturday) ===
    const WEEKLY_WEIGHT_BY_DAY_KEY = "ironPulseWeeklyWeightByDay";


    // Splits by day (you already had this)
    const splits = [
        {
            name: "Push Day â€“ Chest, Shoulders, Triceps",
            days: "Example: Mon / Thu",
            description: "Press-focused session with plenty of push volume.",
            exercises: [
                "Barbell or DB Bench Press â€“ 4 x 6â€“8",
                "Overhead Press â€“ 3 x 8â€“10",
                "Incline DB Press â€“ 3 x 10â€“12",
                "Lateral Raises â€“ 3 x 15",
                "Cable Triceps Pushdown â€“ 3 x 12â€“15"
            ]
        },
        {
            name: "Pull Day â€“ Back, Biceps",
            days: "Example: Tue / Fri",
            description: "Pull-heavy work to build your back and biceps.",
            exercises: [
                "Deadlifts or RDL â€“ 4 x 5",
                "Pull-Ups or Lat Pulldown â€“ 4 x 8â€“10",
                "Seated Row â€“ 3 x 10â€“12",
                "Face Pulls â€“ 3 x 15",
                "Barbell or DB Curls â€“ 3 x 10â€“12"
            ]
        },
        {
            name: "Leg Day â€“ Quads, Hamstrings, Glutes",
            days: "Example: Wed / Sat",
            description: "Lower-body work that actually moves the bar.",
            exercises: [
                "Squats â€“ 4 x 5â€“8",
                "Romanian Deadlift â€“ 3 x 8â€“10",
                "Leg Press or Lunges â€“ 3 x 10â€“12",
                "Hamstring Curls â€“ 3 x 12â€“15",
                "Calf Raises â€“ 3 x 15â€“20"
            ]
        },
        {
            name: "Full Body â€“ Lighter Day",
            days: "Example: Sunday or optional",
            description: "Keep the habit alive with lighter full-body work.",
            exercises: [
                "Goblet Squats â€“ 3 x 10",
                "Push-Ups â€“ 3 x AMRAP",
                "DB Rows â€“ 3 x 10â€“12",
                "Plank â€“ 3 x 30â€“45 seconds"
            ]
        }
    ];

    function scrollToFinisherSection() {
        const section = document.getElementById("finisher");
        if (!section) return;
        section.scrollIntoView({ behavior: "smooth", block: "start" });
    }



    function getTodayDateKey() {
            const d = new Date();
            const y = d.getFullYear();
            const m = String(d.getMonth() + 1).padStart(2, "0");
            const day = String(d.getDate()).padStart(2, "0");
            return `${y}-${m}-${day}`; // e.g. "2025-11-24"
        }


// ----- Rest token helpers -----
    function getRestTokens() {
        const raw = localStorage.getItem(REST_TOKENS_KEY);
        const num = parseInt(raw ?? "0", 10);
        return Number.isNaN(num) ? 0 : Math.max(0, num);
    }

    function setRestTokens(value) {
            const capped = Math.max(0, Math.min(MAX_REST_TOKENS, value));
            localStorage.setItem(REST_TOKENS_KEY, String(capped));
        }


    function getRestTokenProgress() {
        const raw = localStorage.getItem(REST_TOKEN_PROGRESS_KEY);
        const num = parseFloat(raw ?? "0");
        if (Number.isNaN(num)) return 0;
        return Math.min(Math.max(num, 0), 1);
    }

    function setRestTokenProgress(value) {
        const clamped = Math.min(Math.max(value, 0), 1);
        localStorage.setItem(REST_TOKEN_PROGRESS_KEY, String(clamped));
    }

    function addRestTokenProgress(amount) {
            let progress = getRestTokenProgress();
            let tokens = getRestTokens();

            // Already maxed out â†’ keep bar full, do nothing else
            if (tokens >= MAX_REST_TOKENS) {
                setRestTokenProgress(1);
                showToast?.("Rest token stash is full. Time to spend a few. ðŸ˜´");
                return;
            }

            progress += amount;

            // Convert progress â†’ tokens, but never exceed the cap
            while (progress >= 1 && tokens < MAX_REST_TOKENS) {
                tokens += 1;
                progress -= 1;
            }

            // If we somehow overshoot at the exact moment we hit cap
            if (tokens >= MAX_REST_TOKENS) {
                tokens = MAX_REST_TOKENS;
                progress = 0; // clean bar once fully capped
            }

            setRestTokens(tokens);
            setRestTokenProgress(progress);
        }


    // ----- Weekly weight helpers -----
    function getWeeklyWeightByDay() {
        try {
            const raw = localStorage.getItem(WEEKLY_WEIGHT_BY_DAY_KEY);
            if (!raw) return {};
            const parsed = JSON.parse(raw);
            return parsed && typeof parsed === "object" ? parsed : {};
        } catch {
            return {};
        }
    }

    function setWeeklyWeightByDay(map) {
        try {
            localStorage.setItem(WEEKLY_WEIGHT_BY_DAY_KEY, JSON.stringify(map));
        } catch {
            // ignore
        }
    }

    function resetWeeklyWeightByDay() {
        localStorage.removeItem(WEEKLY_WEIGHT_BY_DAY_KEY);
    }

    function addTodayWeight(volumeLbs) {
        const dayIndex = new Date().getDay(); // 0-6
        const map = getWeeklyWeightByDay();
        const prev = parseFloat(map[dayIndex] ?? "0") || 0;
        map[dayIndex] = prev + Math.max(0, volumeLbs);
        setWeeklyWeightByDay(map);
    }

    function getWeeklyTotalWeight() {
        const map = getWeeklyWeightByDay();
        return Object.values(map).reduce((sum, v) => sum + (parseFloat(v) || 0), 0);
    }

    function getWeeklyStreak() {
            const raw = localStorage.getItem(WEEKLY_STREAK_KEY);
            const num = parseInt(raw ?? "0", 10);
            return Number.isNaN(num) ? 0 : num;
        }

    function setWeeklyStreak(value) {
        const safe = Math.max(0, value);
        localStorage.setItem(WEEKLY_STREAK_KEY, String(safe));
        }

    function getLastEmblemClass() {
            return localStorage.getItem(LAST_EMBLEM_KEY) || "";
        }

    function setLastEmblemClass(cls) {
        localStorage.setItem(LAST_EMBLEM_KEY, cls);
    }



    function getCurrentWeekId() {
            const today = new Date();

            // Treat week as starting Monday
            const dayIndex = (today.getDay() + 6) % 7; // Sun=0 â†’ 6, Mon=1 â†’ 0, etc.
            const monday = new Date(today);
            monday.setDate(today.getDate() - dayIndex);

            const y = monday.getFullYear();
            const m = String(monday.getMonth() + 1).padStart(2, "0");
            const d = String(monday.getDate()).padStart(2, "0");

            return `${y}-${m}-${d}`; // e.g. "2025-11-17"
        }



    function getWorkoutsCompletedThisWeek() {
            const raw = localStorage.getItem(WORKOUTS_THIS_WEEK_KEY);
            const num = parseInt(raw ?? "0", 10);
            return Number.isNaN(num) ? 0 : num;
        }

        function setWorkoutsCompletedThisWeek(value) {
            localStorage.setItem(WORKOUTS_THIS_WEEK_KEY, String(Math.max(0, value)));
        }

        function getRotationIndex() {
            const raw = localStorage.getItem(ROTATION_INDEX_KEY);
            const num = parseInt(raw ?? "0", 10);
            if (Number.isNaN(num)) return 0;
            // Make sure it always stays within the rotation length
            return num % ROTATION_ORDER.length;
        }

        function setRotationIndex(value) {
            const normalized = value % ROTATION_ORDER.length;
            localStorage.setItem(ROTATION_INDEX_KEY, String(normalized));
        }


    function getTodaySplitIndex() {
            // Use the rotation index and map it into the splits array
            const rotationIndex = getRotationIndex();      // 0..(ROTATION_ORDER.length-1)
            return ROTATION_ORDER[rotationIndex];          // returns an index into `splits`
        }


    function getTodaySplitDefinition() {
            const rotationIndex = getRotationIndex();        // 0..(ROTATION_ORDER.length - 1)
            const splitIndex = ROTATION_ORDER[rotationIndex]; // maps into `splits` array
            const weeklyGoal = getWeeklyGoal() || DEFAULT_WEEKLY_GOAL;

            const template = splits[splitIndex];

            if (!template) {
                // super defensive fallback so the app never breaks
                return {
                    name: "Training Day",
                    description: "Simple training session. Get in, move some weight, and get out.",
                    exercises: [],
                    daysLabel: `${weeklyGoal} days / week`
                };
            }

            return {
                ...template,
                daysLabel: `${weeklyGoal} days / week`
            };
        }

        function describeHeavyComparison(totalLbs) {
                if (totalLbs <= 0) {
                    return "No volume logged yet. Start lifting and weâ€™ll keep score for you.";
                }

                // super loose, fun comparisons
                const objects = [
                    { threshold: 2000, label: "about the weight of a small car" },
                    { threshold: 4000, label: "roughly a full-size pickup truck" },
                    { threshold: 10000, label: "around a loaded delivery truck" },
                    { threshold: 20000, label: "close to a city bus" },
                    { threshold: 50000, label: "more than a fire truck" },
                    { threshold: 100000, label: "roughly a small airplane" }
                ];

                let best = objects[0];
                for (const obj of objects) {
                    if (totalLbs >= obj.threshold) {
                        best = obj;
                    } else {
                        break;
                    }
                }

                const cars = (totalLbs / 4000).toFixed(1);

                return `Youâ€™ve moved a total of ${Math.round(totalLbs).toLocaleString()} lbs this week â€” roughly ${cars} car(s) worth of weight, or ${best.label}.`;
            }

            function getVolumeTierInfo(totalLbs) {
                    // Make sure total is non-negative
                    const total = Math.max(0, totalLbs || 0);

                    let current = VOLUME_OBJECTS[0];
                    let next = null;

                    for (let i = 0; i < VOLUME_OBJECTS.length; i++) {
                        const tier = VOLUME_OBJECTS[i];
                        if (total >= tier.threshold) {
                            current = tier;
                            next = VOLUME_OBJECTS[i + 1] || null;
                        } else {
                            // first tier whose threshold we haven't reached yet
                            next = tier;
                            break;
                        }
                    }

                    let progress = 1;
                    if (next) {
                        const span = Math.max(next.threshold - current.threshold, 1);
                        const base = total - current.threshold;
                        progress = Math.min(Math.max(base / span, 0), 1);
                    } else {
                        progress = 1; // at or beyond the last object
                    }

                    return { current, next, progress };
                }


        function updateWeeklyVolumeSummary() {
                const emojiEl = document.getElementById("volume-object-emoji");
                const labelEl = document.getElementById("volume-object-label");
                const barFillEl = document.getElementById("volume-bar-fill");
                const captionEl = document.getElementById("volume-bar-caption");

                if (!emojiEl || !labelEl || !barFillEl || !captionEl) return;

                const total = getWeeklyTotalWeight();
                const { current, next, progress } = getVolumeTierInfo(total);

                // --- Basic display ---
                emojiEl.textContent = current.emoji;
                labelEl.textContent = current.label;

                const pct = Math.round(progress * 100);
                barFillEl.style.width = `${Math.min(Math.max(pct, 0), 100)}%`;

                const totalPretty = Math.round(total).toLocaleString();

                if (!next) {
                    // Maxed out ladder for now
                    captionEl.textContent =
                        `Youâ€™ve moved ${totalPretty} lbs this week â€” youâ€™ve out-lifted our heaviest tier. Monster status.`;
                } else if (current.id === "start" && total === 0) {
                    captionEl.textContent =
                        "You havenâ€™t logged any weight yet this week â€” every set you do moves this bar.";
                } else {
                    const toNext = Math.max(next.threshold - total, 0);
                    const toNextPretty = Math.round(toNext).toLocaleString();
                    captionEl.textContent =
                        `Youâ€™ve moved ${totalPretty} lbs â€” ${pct}% of the way to a ${next.label} (${toNextPretty} lbs to go).`;
                }

                // --- Level-up detection & explosion animation ---
                const lastTierId = localStorage.getItem(VOLUME_TIER_KEY);
                const leveledUp = lastTierId && lastTierId !== current.id && total > 0;

                // Remember current tier for next time
                localStorage.setItem(VOLUME_TIER_KEY, current.id);

                if (leveledUp) {
                    const barBlock = document.querySelector(".volume-bar-block");
                    if (barBlock) {
                        barBlock.classList.add("volume-levelup");
                        // reset after animation
                        setTimeout(() => {
                            barBlock.classList.remove("volume-levelup");
                        }, 800);
                    }

                    emojiEl.classList.add("levelup-pop");
                    setTimeout(() => {
                        emojiEl.classList.remove("levelup-pop");
                    }, 650);
                }
            }



    // =============================
    // 2) STORAGE HELPERS
    // =============================
    function getWeeklyGoal() {
            const stored = localStorage.getItem(WEEKLY_GOAL_KEY);
            if (!stored) {
                return null; // ðŸ”¹ explicit â€œno goal setâ€
            }
            const num = parseInt(stored, 10);
            return isNaN(num) ? null : num;
        }


    function setWeeklyGoal(days) {
        localStorage.setItem(WEEKLY_GOAL_KEY, String(days));
    }
    function hasWeeklyGoal() {
            return localStorage.getItem(WEEKLY_GOAL_KEY) !== null;
        }
    function repositionWeeklyGoalSection() {
            const days = getWeeklyGoal();  // null when no goal set
            const dailyScreen = document.getElementById("screen-daily");
            const weeklyFocus = document.getElementById("weekly-focus-live");
            const goalSection = document.getElementById("weekly-goal-control");
            const dailyMain = document.getElementById("daily-main-content");

            if (!dailyScreen || !weeklyFocus || !goalSection || !dailyMain) return;

            if (!days) {
                // ðŸ”¸ No weekly goal set:
                // - hide split/motivation/finisher
                // - move goal section right under the focus card
                dailyMain.classList.add("hidden");

                // weeklyFocus is before dailyMain, so insert goalSection before dailyMain
                dailyScreen.insertBefore(goalSection, dailyMain);
            } else {
                // ðŸ”¹ Goal is set:
                // - show workouts
                // - keep goal selector down at the bottom
                dailyMain.classList.remove("hidden");

                dailyScreen.appendChild(goalSection);
            }
        }




    // (You may also have streak storage later)

    // =============================
    // 3) QUOTES
    // =============================




    // =============================
    // 4) INTENSITY SLIDER
    // =============================
    const intensityWords = [
        "Warming Up", "Focused", "Primed", "Locked In",
        "Beast Mode", "No Limits", "Unstoppable", "Savage"
    ];

    function initIntensitySlider() {
        const intensitySlider = document.getElementById("intensity-slider");
        const intensityValue = document.getElementById("intensity-value");
        const intensityLabel = document.getElementById("intensity-label");

        if (!intensitySlider || !intensityValue || !intensityLabel) return;

        function updateIntensity() {
            const value = parseInt(intensitySlider.value, 10);
            intensityValue.textContent = value;
            const index = Math.min(intensityWords.length - 1, Math.floor(value / 2));
            intensityLabel.textContent = intensityWords[index];
        }

        intensitySlider.addEventListener("input", updateIntensity);
        updateIntensity();
    }

    // =============================
    // 5) WEEKLY FOCUS LIVE CARD
    // =============================


    function renderWeeklyFocusLive() {
            const daysLabelEl = document.getElementById("weekly-focus-days-label");
            const summaryEl = document.getElementById("weekly-focus-summary");
            if (!daysLabelEl || !summaryEl) return;

            const days = getWeeklyGoal();
            if (!days) {
                daysLabelEl.textContent = "No weekly goal set";
                summaryEl.textContent = "Pick a weekly training goal below to lock in how many days youâ€™re committing to this week.";
                return;
            }

            daysLabelEl.textContent = `${days} days / week`;

            const descriptions = {
                3: "Youâ€™re committing to 3 focused sessions this week. Expect heavier full-body or big compound days that earn your rest.",
                4: "Youâ€™re training 4 days this week. A solid balance of work and recovery that fits most busy schedules.",
                5: "Youâ€™re aiming for 5 days. Higher frequency, slightly smaller sessions so you can show up often without burning out.",
                6: "6 days on. Youâ€™re chasing serious momentum. Weâ€™ll mix push/pull/legs with built-in lighter work to keep you moving.",
                7: "Daily movement mode. Training every day with a blend of lifting, lighter days, and recovery work to keep the habit alive."
            };

            summaryEl.textContent =
                descriptions[days] ||
                "You set your training goal for this week. Show up for it, one session at a time.";
        }



    function initWeeklyGoalControls() {
            const dailyScreen = document.getElementById("screen-daily");
            if (!dailyScreen) return;

            const pills = dailyScreen.querySelectorAll(".day-pill");
            if (!pills.length) return;

            const resetBtn = document.getElementById("reset-weekly-goal-btn");
            const commitBtn = document.getElementById("commit-weekly-goal-btn");

            const currentGoal = getWeeklyGoal();
            const isLocked = localStorage.getItem(WEEKLY_GOAL_LOCKED_KEY) === "true";

            let pendingDays = null; // what the user has selected but not committed yet

            // Reset button visibility: only show if a goal actually exists
            if (resetBtn) {
                resetBtn.style.display = currentGoal ? "inline-flex" : "none";
            }

            // Commit button starts hidden
            if (commitBtn) {
                commitBtn.style.display = "none";
            }

            // Initialize pill states
            pills.forEach(pill => {
                const pillDays = parseInt(pill.getAttribute("data-days"), 10);

                if (currentGoal && pillDays === currentGoal) {
                    pill.classList.add("active");
                }

                if (isLocked) {
                    pill.disabled = true;
                }

                pill.addEventListener("click", () => {
                    if (localStorage.getItem(WEEKLY_GOAL_LOCKED_KEY) === "true") {
                        return;
                    }

                    pendingDays = pillDays;

                    pills.forEach(p => p.classList.remove("active"));
                    pill.classList.add("active");

                    if (commitBtn) {
                        commitBtn.style.display = "inline-flex";
                    }
                });
            });

            // âœ… Commit the weekly goal (lock it + reset progress + rotation)
            if (commitBtn) {
                commitBtn.addEventListener("click", () => {
                    if (localStorage.getItem(WEEKLY_GOAL_LOCKED_KEY) === "true") return;
                    if (!pendingDays) return;

                    const confirmCommit = window.confirm(
                        `Commit to training ${pendingDays} days this week?`
                    );
                    if (!confirmCommit) return;

                    setWeeklyGoal(pendingDays);
                    localStorage.setItem(WEEKLY_GOAL_LOCKED_KEY, "true");

                    // ðŸ”¹ Reset progress + rotation for a fresh week
                    setWorkoutsCompletedThisWeek(0);
                    setRotationIndex(0);

                    pills.forEach(p => {
                        p.disabled = true;
                    });

                    if (commitBtn) {
                        commitBtn.style.display = "none";
                    }
                    if (resetBtn) {
                        resetBtn.style.display = "inline-flex";
                    }

                    renderWeeklyFocusLive();
                    repositionWeeklyGoalSection();
                    renderTodaySplit();
                    updateStreak();
                });
            }

            // âœ… Reset weekly goal (also reset progress + rotation)
            if (resetBtn) {
                resetBtn.addEventListener("click", () => {
                    const firstConfirm = window.confirm(
                        "Are you sure you want to reset this weekâ€™s training goal?"
                    );
                    if (!firstConfirm) return;

                    const secondConfirm = window.confirm(
                        "Resetting will clear your current weekly goal and unlock the day selector.\n\n" +
                        "Use this if your schedule changed, not because today feels hard.\n\nContinue?"
                    );
                    if (!secondConfirm) return;

                    localStorage.removeItem(WEEKLY_GOAL_KEY);
                    localStorage.removeItem(WEEKLY_GOAL_LOCKED_KEY);

                    // ðŸ”¹ Reset progress + rotation when goal is reset
                    setWorkoutsCompletedThisWeek(0);
                    setRotationIndex(0);

                    pills.forEach(p => {
                        p.classList.remove("active");
                        p.disabled = false;
                    });

                    if (resetBtn) {
                        resetBtn.style.display = "none";
                    }
                    if (commitBtn) {
                        commitBtn.style.display = "none";
                    }

                    pendingDays = null;

                    renderWeeklyFocusLive();
                    repositionWeeklyGoalSection();
                    renderTodaySplit();
                    updateStreak();
                });
            }
            renderWeeklyFocusLive();
            repositionWeeklyGoalSection();
        }



    // ===== SPLIT TEMPLATES =====

        const FINISHERS = {
                conditioning: {
                    easy: {
                        title: "5-Min Incline Walk",
                        description: "Walk on the treadmill or around the gym for 5 minutes at a steady pace.",
                        tokenReward: 0
                    },
                    standard: {
                        title: "10-Min Cardio Block",
                        description: "Bike, rower, or stair master for 10 minutes at a moderate pace.",
                        tokenReward: 0.25
                    },
                    hard: {
                        title: "1-Mile Push",
                        description: "Walk or jog 1 mile. Keep it honest but sustainable.",
                        tokenReward: 1
                    }
                },
                bodyweight: {
                    easy: {
                        title: "Core Check-In",
                        description: "1 minute plank (can be broken into two 30s holds).",
                        tokenReward: 0
                    },
                    standard: {
                        title: "Simple Bodyweight Circuit",
                        description: "3 rounds: 10 push-ups, 15 bodyweight squats, 20 jumping jacks.",
                        tokenReward: 0.25
                    },
                    hard: {
                        title: "Burpee Challenge",
                        description: "50 burpees for time, or as many as you can in 4 minutes.",
                        tokenReward: 1
                    }
                },
                pump: {
                    easy: {
                        title: "30-Rep Pump",
                        description: "Pick any machine or dumbbell movement and do 30 controlled reps.",
                        tokenReward: 0
                    },
                    standard: {
                        title: "50-Rep Combo",
                        description: "Superset biceps and triceps for a total of 50 reps.",
                        tokenReward: 0.25
                    },
                    hard: {
                        title: "100-Rep Finisher",
                        description: "Choose one movement (curls, pushdowns, lateral raises, etc.) and complete 100 total reps.",
                        tokenReward: 1
                    }
                },
                recovery: {
                    easy: {
                        title: "3-Min Stretch Reset",
                        description: "Spend at least 3 minutes stretching hips, hamstrings, and chest.",
                        tokenReward: 0
                    },
                    standard: {
                        title: "Mobility Flow",
                        description: "5â€“8 minutes of light mobility work: cat-cow, worldâ€™s greatest stretch, shoulder circles.",
                        tokenReward: 0
                    },
                    hard: null // no hard tier for recovery; hard work earns tokens elsewhere
                }
            };

        const SPLIT_TEMPLATES = {
            push: {
                name: "Push Day â€“ Chest, Shoulders, Triceps",
                description: "Press-focused session with classic upper body movements.",
                exercises: [
                    "Barbell or DB Bench Press â€“ 4 x 6â€“8",
                    "Incline DB Press â€“ 3 x 8â€“10",
                    "Overhead Shoulder Press (DB or machine) â€“ 3 x 8â€“10",
                    "Lateral Raises â€“ 3 x 12â€“15",
                    "Cable or Rope Triceps Pushdown â€“ 3 x 10â€“12"
                ]
            },
            pull: {
                name: "Pull Day â€“ Back, Biceps",
                description: "Back and biceps work with simple pulling patterns.",
                exercises: [
                    "Lat Pulldown or Assisted Pull-Up â€“ 4 x 8â€“10",
                    "Seated Row (cable or machine) â€“ 3 x 8â€“10",
                    "Chest-Supported Row or DB Row â€“ 3 x 10â€“12",
                    "Face Pulls â€“ 3 x 12â€“15",
                    "EZ-Bar or DB Curls â€“ 3 x 10â€“12"
                ]
            },
            legs: {
                name: "Leg Day â€“ Quads, Hamstrings, Glutes",
                description: "Lower-body focus with basic barbell or machine work.",
                exercises: [
                    "Back Squat or Hack Squat â€“ 4 x 6â€“8",
                    "Romanian Deadlift â€“ 3 x 8â€“10",
                    "Leg Press or Walking Lunges â€“ 3 x 10â€“12",
                    "Leg Curl (machine) â€“ 3 x 10â€“12",
                    "Standing or Seated Calf Raise â€“ 3 x 12â€“15"
                ]
            },
            upper: {
                name: "Upper Body â€“ Mixed",
                description: "Balanced upper session for chest, back, and arms.",
                exercises: [
                    "Flat Bench Press â€“ 3 x 6â€“8",
                    "Lat Pulldown â€“ 3 x 8â€“10",
                    "DB Shoulder Press â€“ 3 x 8â€“10",
                    "Cable Row â€“ 3 x 10â€“12",
                    "Biceps Curls + Triceps Pushdowns superset â€“ 2â€“3 x 10â€“12"
                ]
            },
            lower: {
                name: "Lower Body â€“ Mixed",
                description: "Lower day with a bit less volume for higher-frequency weeks.",
                exercises: [
                    "Front Squat or Leg Press â€“ 3 x 6â€“8",
                    "Romanian Deadlift â€“ 3 x 8â€“10",
                    "Leg Curl â€“ 2â€“3 x 10â€“12",
                    "Calf Raises â€“ 3 x 12â€“15"
                ]
            },
            full: {
                name: "Full Body â€“ Strength Focus",
                description: "Hit the main lifts in one session with simple accessories.",
                exercises: [
                    "Squat (any variation) â€“ 3 x 5â€“8",
                    "Bench Press or DB Press â€“ 3 x 5â€“8",
                    "Row (barbell or cable) â€“ 3 x 8â€“10",
                    "Lat Pulldown â€“ 3 x 8â€“10",
                    "Plank or Cable Crunch â€“ 3 sets"
                ]
            },
            recovery: {
                name: "Recovery / Light Movement",
                description: "Rest day. Focus on moving just enough to feel good.",
                exercises: [
                    "10â€“20 min easy walk",
                    "5â€“10 min light stretching or foam rolling"
                ]
            }
        };

     function evaluateLastWeekForStreak() {
            const goal = getWeeklyGoal();
            const done = getWorkoutsCompletedThisWeek();

            // No goal set â†’ we don't maintain a streak for that week
            if (!goal) {
                setWeeklyStreak(0);
                return;
            }

            const currentStreak = getWeeklyStreak();
            let tokens = getRestTokens();

            const shortfall = Math.max(goal - done, 0);

            // Already met or exceeded the goal â†’ easy win, no tokens needed
            if (shortfall === 0) {
                setWeeklyStreak(currentStreak + 1);
                return;
            }

            // No tokens to help and didnâ€™t meet goal â†’ streak breaks
            if (tokens <= 0) {
                setWeeklyStreak(0);
                return;
            }

            // How many tokens would we need to cover the gap?
            const tokensNeeded = shortfall;
            const tokensWeCanUse = Math.min(tokensNeeded, tokens);
            const effectiveDone = done + tokensWeCanUse;

            if (effectiveDone >= goal) {
                // âœ… Tokens SAVE the streak â†’ spend them
                tokens -= tokensWeCanUse;
                setRestTokens(tokens);
                setRestTokenProgress(0); // fresh bar for next token

                setWeeklyStreak(currentStreak + 1);

                showToast?.(
                    `Rest tokens saved your streak this week (${tokensWeCanUse} used).`
                );
            } else {
                // âŒ Even using all tokens wouldn't reach the goal â†’ don't burn them
                setWeeklyStreak(0);
                // tokens stay as-is for another week
            }
        }


        function ensureWeeklyState() {
            const currentWeekId = getCurrentWeekId();
            const storedWeekId = localStorage.getItem(WEEK_ID_KEY);

            // First time using the app: initialize week ID and bail
            if (!storedWeekId) {
                localStorage.setItem(WEEK_ID_KEY, currentWeekId);
                return;
            }

            // Same week â†’ nothing to do
            if (storedWeekId === currentWeekId) {
                return;
            }

            // ðŸš€ New week detected:
            // 1) Evaluate last week for streak
            evaluateLastWeekForStreak();

            // 2) Reset weekly counters for the new week
            setWorkoutsCompletedThisWeek(0);
            setRotationIndex(0);
            resetWeeklyWeightByDay();
            // After resetting + evaluating streak
            updateStreak();


            // 3) Store the new week ID
            localStorage.setItem(WEEK_ID_KEY, currentWeekId);
        }
   

    let hasRecordedCompletionForCurrentSplit = false;    

    function renderTodaySplit() {
            const splitNameEl = document.getElementById("split-name");
            const splitDaysEl = document.getElementById("split-days");
            const splitDescEl = document.getElementById("split-description");
            const exerciseListEl = document.getElementById("exercise-list");

            if (!splitNameEl || !exerciseListEl) return;

            hasRecordedCompletionForCurrentSplit = false;

            const split = getTodaySplitDefinition();
            const weightMap = getExerciseWeights(); 

            splitNameEl.textContent = split.name;
            splitDaysEl.textContent = split.daysLabel || "";
            splitDescEl.textContent = split.description || "";

            // Clear old list
            exerciseListEl.innerHTML = "";

            // Rest / recovery day: no checkboxes, just a message
            if (!split.exercises || split.exercises.length === 0) {
                const li = document.createElement("li");
                li.style.marginBottom = "0.5rem";
                li.textContent =
                    "Rest or keep it light today. Walk, stretch, or move just enough to feel good.";
                exerciseListEl.appendChild(li);

                if (typeof checkSplitCompletion === "function") {
                    checkSplitCompletion();
                }
                return;
            }

            split.exercises.forEach((exercise, index) => {
                const li = document.createElement("li");
                li.style.marginBottom = "0.75rem";

                const checkboxId = `exercise-${index}`;
                const weightInputId = `weight-${index}`;
                const savedWeight = weightMap[exercise] ?? "";

                li.innerHTML = `
            <label style="display:flex;align-items:center;gap:0.5rem;cursor:pointer;">
                <input type="checkbox" id="${checkboxId}" />
                <span>${exercise}</span>
            </label>
            <div class="weight-row">
                <span>Avg weight used:</span>
                <input
                    type="number"
                    id="${weightInputId}"
                    inputmode="decimal"
                    min="0"
                    step="5"
                    value="${savedWeight !== "" ? savedWeight : ""}"
                    data-exercise="${exercise}"
                />
                <span>lbs</span>
            </div>
        `;

                exerciseListEl.appendChild(li);

                // Checkbox behavior (haptic + finisher check)
                const checkbox = li.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.addEventListener("change", () => {
                        if (checkbox.checked && "vibrate" in navigator) {
                            navigator.vibrate(20);
                        }
                        if (typeof checkSplitCompletion === "function") {
                            checkSplitCompletion();
                        }
                    });
                }

                // Weight input behavior (save last used weight)
                const weightInput = li.querySelector(`#${weightInputId}`);
                if (weightInput) {
                    weightInput.addEventListener("change", () => {
                        const exerciseName = weightInput.getAttribute("data-exercise");
                        const rawValue = weightInput.value.trim();
                        const num = parseFloat(rawValue);

                        const weights = getExerciseWeights();
                        if (!isNaN(num) && num > 0) {
                            weights[exerciseName] = num;
                        } else {
                            delete weights[exerciseName];
                        }
                        saveExerciseWeights(weights);
                    });
                }
            });

            if (typeof checkSplitCompletion === "function") {
                checkSplitCompletion();
            }
        }

    function getStreakTier(weeks) {
            if (weeks <= 0) return { tier: "none", level: 0 };

            if (weeks <= 3) return { tier: "weekly", level: weeks };          // 1â€“3
            if (weeks <= 7) return { tier: "monthly", level: 1 };              // 4â€“7
            if (weeks <= 11) return { tier: "monthly", level: 2 };              // 8â€“11
            if (weeks <= 15) return { tier: "monthly", level: 3 };              // 12â€“15

            if (weeks <= 23) return { tier: "quarterly", level: 1 };             // 16â€“23
            if (weeks <= 35) return { tier: "quarterly", level: 2 };             // 24â€“35
            if (weeks <= 51) return { tier: "quarterly", level: 3 };             // 36â€“51

            if (weeks <= 103) return { tier: "annual", level: 1 };             //  1 year+
            if (weeks <= 155) return { tier: "annual", level: 2 };             //  2 years+

            return { tier: "legendary", level: 1 };                                   // 3+ years
        }

    function getEmblemVisualForTier(tier) {
            // Default if somehow no tier
            if (!tier) {
                return {
                    icon: "ðŸ”¥",
                    label: "Keep showing up"
                };
            }

            // Group tiers into â€œIron Pulseâ€ progressions
            if (tier.startsWith("emblem-weekly")) {
                // Very first weeks â€“ simple iron plate
                return {
                    icon: "â¬¢",
                    label: "Bronze â€“ Iron Spark"
                };
            }

            if (tier.startsWith("emblem-monthly")) {
                // 1â€“3 months â€“ reinforced shield
                return {
                    icon: "ðŸ›¡ï¸",
                    label: "Silver â€“ Iron Guard"
                };
            }

            if (tier.startsWith("emblem-quarterly")) {
                // 4â€“9 months â€“ crossed weapons / reaper feel
                return {
                    icon: "âš”ï¸",
                    label: "Gold â€“ Iron Vanguard"
                };
            }

            if (tier.startsWith("emblem-annual")) {
                // 1+ year â€“ skull-shield
                return {
                    icon: "ðŸ’€",
                    label: "Mythic â€“ Iron Warden"
                };
            }

            if (tier.startsWith("emblem-legendary")) {
                // 2+ years â€“ fully cracked, COD-zombie vibes
                return {
                    icon: "â˜ ï¸",
                    label: "Legendary â€“ Eternal Grind"
                };
            }

            return {
                icon: "ðŸ”¥",
                label: "Streak Active"
            };
        }


    function triggerMilestoneAnimation(tier, level) {
            // temporary placeholder
            showToast(`New streak milestone unlocked: ${tier} ${level}!`);
        }


    function triggerMilestoneAnimation(tier, level) {
            console.log(`ðŸŽ‰ New milestone reached: ${tier} tier level ${level}`);

            // Example (replace later with real animations):
            showToast(`New streak milestone unlocked: ${tier} ${level}!`);

            // Here we can add:
            // - overlay achievement popup
            // - emblem spin/glow
            // - rune burst particles
            // - electricity arc animation
        }
    // --- Emblem tier helpers ---

        // Which emoji + label for each emblem tier
            function getEmblemMetaForTier(tier) {
                switch (tier) {
                    case "emblem-weekly-1":
                        return { emoji: "ðŸ”¥", label: "Week 1 â€“ Sparked" };
                    case "emblem-weekly-2":
                        return { emoji: "ðŸ”¥", label: "Week 2 â€“ Warming Up" };
                    case "emblem-weekly-3":
                        return { emoji: "ðŸ”¥", label: "Week 3 â€“ Dialed In" };

                    case "emblem-monthly-1":
                        return { emoji: "âœ¨", label: "Bronze Grind" };
                    case "emblem-monthly-2":
                        return { emoji: "âœ¨", label: "Silver Grind" };
                    case "emblem-monthly-3":
                        return { emoji: "âœ¨", label: "Gold Grind" };

                    case "emblem-quarterly-1":
                        return { emoji: "âš¡", label: "Quarter 1 â€“ Surge" };
                    case "emblem-quarterly-2":
                        return { emoji: "âš¡", label: "Quarter 2 â€“ Relentless" };
                    case "emblem-quarterly-3":
                        return { emoji: "âš¡", label: "Quarter 3 â€“ Unbreakable" };

                    case "emblem-annual-1":
                        return { emoji: "ðŸ”¥", label: "Annual â€“ Iron Focus" };
                    case "emblem-annual-2":
                        return { emoji: "ðŸ”¥", label: "Annual â€“ Iron Will" };

                    case "emblem-legendary-1":
                        return { emoji: "ðŸ’€ðŸ”¥", label: "Legendary â€“ Eternal Grind" };

                    default:
                        return { emoji: "ðŸ”¥", label: "" };
                }
            }

                function updateEmblemVisuals(tier) {
                        const emblemBox = document.getElementById("streak-emblem");
                        const iconSpan = emblemBox?.querySelector(".streak-emblem-icon");
                        const labelChip = document.getElementById("streak-emblem-label");

                        if (!emblemBox || !iconSpan || !labelChip) {
                            console.warn("Emblem elements missing");
                            return;
                        }

                        // Clear old emblem-* classes on the emblem box itself
                        const toRemove = [];
                        emblemBox.classList.forEach(cls => {
                            if (cls.startsWith("emblem-")) {
                                toRemove.push(cls);
                            }
                        });
                        toRemove.forEach(cls => emblemBox.classList.remove(cls));

                        if (!tier) {
                            iconSpan.textContent = "ðŸ”¥";          // fallback
                            labelChip.textContent = "";
                            return;
                        }

                        const meta = getEmblemMetaForTier(tier);

                        // ðŸ” icon + text
                        iconSpan.textContent = meta.emoji;
                        labelChip.textContent = meta.label;

                        // Let the emblem aura CSS (emblem-*) also style the little box
                        emblemBox.classList.add(tier);
                    }


        function getEmblemTierForStreak(streak) {
                if (!streak || streak <= 0) return null;

                // Very early weeks
                if (streak === 1) return "emblem-weekly-1";
                if (streak === 2) return "emblem-weekly-2";
                if (streak === 3) return "emblem-weekly-3";

                // ~1â€“3 months
                if (streak >= 4 && streak <= 7) return "emblem-monthly-1";
                if (streak >= 8 && streak <= 11) return "emblem-monthly-2";
                if (streak >= 12 && streak <= 15) return "emblem-monthly-3";

                // ~4â€“9 months
                if (streak >= 16 && streak <= 23) return "emblem-quarterly-1";
                if (streak >= 24 && streak <= 35) return "emblem-quarterly-2";
                if (streak >= 36 && streak <= 51) return "emblem-quarterly-3";

                // 1â€“2 years
                if (streak >= 52 && streak <= 77) return "emblem-annual-1";
                if (streak >= 78 && streak <= 103) return "emblem-annual-2";

                // 2+ years â€” split into three legendary sub-tiers
                if (streak >= 104 && streak <= 151) return "emblem-legendary-1";
                if (streak >= 152 && streak <= 199) return "emblem-legendary-2";
                if (streak >= 200) return "emblem-legendary-3";

                return null;
            }

        function getStoredEmblemTier() {
            return localStorage.getItem(EMBLEM_TIER_KEY) || "";
        }

        function setStoredEmblemTier(tier) {
            if (!tier) {
                localStorage.removeItem(EMBLEM_TIER_KEY);
            } else {
                localStorage.setItem(EMBLEM_TIER_KEY, tier);
            }
        }

        function applyEmblemTierClass(banner, tier) {
                const emblem = document.getElementById("streak-emblem");
                const targets = [banner, emblem].filter(Boolean);

                targets.forEach(el => {
                    const toRemove = [];
                    el.classList.forEach(cls => {
                        if (cls.startsWith("emblem-")) {
                            toRemove.push(cls);
                        }
                    });
                    toRemove.forEach(cls => el.classList.remove(cls));

                    if (tier) {
                        el.classList.add(tier);
                    }
                });
            }


        // Friendly name for overlay text
        function getEmblemLabelForTier(tier) {
            const map = {
                "emblem-weekly-1": "Week 1 â€“ Ember Spark",
                "emblem-weekly-2": "Week 2 â€“ Warming Forge",
                "emblem-weekly-3": "Week 3 â€“ Steady Flame",

                "emblem-monthly-1": "Monthly Rank I â€“ Kindled Core",
                "emblem-monthly-2": "Monthly Rank II â€“ Flow State",
                "emblem-monthly-3": "Monthly Rank III â€“ Iron Rhythm",

                "emblem-quarterly-1": "Quarter Rank I â€“ Forged Focus",
                "emblem-quarterly-2": "Quarter Rank II â€“ Relentless Drive",
                "emblem-quarterly-3": "Quarter Rank III â€“ Unbroken Arc",

                "emblem-annual-1": "Annual Rank I â€“ Iron Pulse Year One",
                "emblem-annual-2": "Annual Rank II â€“ Iron Pulse Veteran",

                "emblem-legendary-1": "Legendary â€“ Eternal Grind"
            };
            return map[tier] || "New Emblem Unlocked";
        }

        // Full-screen rank-up overlay
        function showRankUpOverlay(tier) {
            const label = getEmblemLabelForTier(tier);

            const overlay = document.createElement("div");
            overlay.className = "rankup-overlay";

            overlay.innerHTML = `
        <div class="rankup-inner">
            <div class="rankup-emblem-preview ${tier}">
                <span class="rankup-icon">ðŸ”¥</span>
            </div>
            <h2>New Emblem Unlocked</h2>
            <p>${label}</p>
            <button type="button" class="btn btn-primary rankup-close">Continue</button>
        </div>
    `;

            document.body.appendChild(overlay);

            const close = () => overlay.remove();

            overlay.addEventListener("click", (e) => {
                if (e.target === overlay) close();
            });

            const btn = overlay.querySelector(".rankup-close");
            if (btn) {
                btn.addEventListener("click", close);
            }
        }

        function triggerEmblemRankUp(tier, visuals) {
                const overlay = document.createElement("div");
                overlay.className = "rankup-overlay";

                overlay.innerHTML = `
        <div class="rankup-inner">
            <div class="rankup-emblem-preview ${tier}">
                <span class="rankup-icon">${visuals.icon}</span>
            </div>
            <h2>New Emblem Unlocked</h2>
            <p>${visuals.label}</p>
            <button type="button" class="btn btn-primary">Nice</button>
        </div>
    `;

                document.body.appendChild(overlay);
                const btn = overlay.querySelector("button");
                btn?.addEventListener("click", () => overlay.remove());
            }


        // Called from updateStreak()
        function handleEmblemTier(streak) {
                const banner = document.getElementById("streak-banner");
                if (!banner) return;

                const emblemEl = document.getElementById("streak-emblem");
                const emblemIconSpan = emblemEl?.querySelector(".streak-emblem-icon");
                const emblemLabelEl = document.getElementById("streak-emblem-label");

                const newTier = getEmblemTierForStreak(streak);
                const prevTier = getStoredEmblemTier();

                // No streak â†’ clear emblem + label
                if (!newTier) {
                    applyEmblemTierClass(banner, null);
                    setStoredEmblemTier("");
                    if (emblemIconSpan) emblemIconSpan.textContent = "ðŸ”¥";
                    if (emblemLabelEl) emblemLabelEl.textContent = "Keep showing up";
                    return;
                }

                // Always apply tier classes
                applyEmblemTierClass(banner, newTier);

                // Set icon + label based on the tier
                const visuals = getEmblemVisualForTier(newTier);
                if (emblemIconSpan) emblemIconSpan.textContent = visuals.icon;
                if (emblemLabelEl) emblemLabelEl.textContent = visuals.label;

                // First emblem ever â†’ just store it, no pop
                if (!prevTier) {
                    setStoredEmblemTier(newTier);
                    return;
                }

                // If tier changed â†’ rank up!
                if (prevTier !== newTier) {
                    setStoredEmblemTier(newTier);
                    triggerEmblemRankUp(newTier, visuals);
                }
            }




    // Map weekly streak â†’ tier window (start/end week inside that tier)
    function getStreakTierBounds(streak) {
        if (streak <= 0) return null;

        // ðŸ”¹ You can tweak these ranges anytime
        if (streak <= 3) {
            // 1â€“3 weeks â†’ Weekly emblem tier
            return { name: "weekly", start: 1, end: 3 };
        } else if (streak <= 7) {
            // 4â€“7 weeks â†’ Monthly tier 1
            return { name: "monthly-1", start: 4, end: 7 };
        } else if (streak <= 11) {
            // 8â€“11 weeks â†’ Monthly tier 2
            return { name: "monthly-2", start: 8, end: 11 };
        } else if (streak <= 17) {
            // 12â€“17 weeks â†’ Quarterly tier 1
            return { name: "quarterly-1", start: 12, end: 17 };
        } else if (streak <= 25) {
            // 18â€“25 weeks â†’ Quarterly tier 2
            return { name: "quarterly-2", start: 18, end: 25 };
        } else {
            // 26+ weeks â†’ Long-term / yearly tier
            return { name: "year-1", start: 26, end: 52 };
        }
    }

    function updateEmblemIconForTier(tier) {
            if (!iconEl) {
                console.warn("No .streak-icon element found");
                return;
            }

            let symbol = "ðŸ”¥";

            switch (tier) {
                case "emblem-weekly-1":
                case "emblem-weekly-2":
                case "emblem-weekly-3":
                    symbol = "ðŸ”¥"; // base
                    break;

                case "emblem-monthly-1":
                case "emblem-monthly-2":
                case "emblem-monthly-3":
                    symbol = "âš¡";
                    break;

                case "emblem-quarterly-1":
                case "emblem-quarterly-2":
                case "emblem-quarterly-3":
                    symbol = "ðŸ’¥";
                    break;

                case "emblem-annual-1":
                case "emblem-annual-2":
                case "emblem-legendary-1":
                    symbol = "ðŸ‘‘";
                    break;
            }

            iconEl.textContent = symbol;

            // ðŸ” debug
            console.log("updateEmblemIconForTier â†’ tier:", tier, "symbol:", symbol);
        }



    function updateStreak() {
            const banner = document.getElementById("streak-banner");
            const weekLabelEl = document.getElementById("streak-week-label");
            const tokenLabelEl = document.getElementById("streak-token-label");
            const progressTextEl = document.getElementById("streak-text");
            const progressFillEl = document.getElementById("streak-progress-fill");
            const emblemLabelEl = document.getElementById("streak-emblem-label"); // ðŸ”¥ NEW


            if (!banner || !weekLabelEl || !tokenLabelEl || !progressTextEl || !progressFillEl) return;

            const goal = getWeeklyGoal();
            const done = getWorkoutsCompletedThisWeek();
            const streak = getWeeklyStreak?.() ?? 0;
            const tokens = getRestTokens();
            const tokenProgress = getRestTokenProgress();

            // âŒ No goal set â†’ banner off, aura off
            if (!goal) {
                banner.classList.add("hidden");
                banner.classList.remove("streak-active");
                banner.style.setProperty("--emblem-strength", "0");
                return;
            }

            banner.classList.remove("hidden");

            // 1) Week label chip
            if (streak > 0) {
                weekLabelEl.textContent = `Week ${streak} streak`;
            } else {
                weekLabelEl.textContent = "No active streak yet";
            }

            // 2) Progress text
            const clampedDone = Math.min(done, goal);
            const progressPct = Math.round((clampedDone / goal) * 100);
            progressTextEl.textContent = `${done} / ${goal} sessions â€¢ ${progressPct}% of weekly goal`;

            // 3) Token label
            if (tokens > 0 || tokenProgress > 0) {
                const tokenPct = Math.round(tokenProgress * 100);
                const extra =
                    tokenProgress > 0 && tokenProgress < 1
                        ? ` â€¢ Next: ${tokenPct}%`
                        : "";
                tokenLabelEl.textContent = `Rest tokens: ${tokens}${extra}`;
            } else {
                tokenLabelEl.textContent = "Earn rest tokens with finishers";
            }
            // Not sure if this goes here lol
            if (emblemLabelEl) {
                const tier = getEmblemTierForStreak(streak);
                if (tier) {
                    const label = getEmblemLabelForTier(tier); 
                    emblemLabelEl.textContent = label;
                    emblemLabelEl.classList.remove("hidden");
                } else {
                    emblemLabelEl.textContent = "";
                    emblemLabelEl.classList.add("hidden");
                }
            }


            // 4) Progress bar fill
            progressFillEl.style.width = `${Math.min(progressPct, 100)}%`;

            handleEmblemTier(streak);


            // 5) Continuous aura intensity (COD skin ramp)
            if (streak > 0) {
                banner.classList.add("streak-active");

                let strength = 0.25; // base for 1 week
                if (streak >= 2 && streak <= 3) {
                    strength = 0.55;
                } else if (streak >= 4 && streak <= 7) {
                    strength = 0.85;
                } else if (streak > 7) {
                    strength = 1.15; // turned up
                }

                banner.style.setProperty("--emblem-strength", String(strength));
            } else {
                banner.classList.remove("streak-active");
                banner.style.setProperty("--emblem-strength", "0");
            }

            // 6) Emblem tier + rank-up overlay / lightning
            if (typeof handleEmblemTier === "function") {
                handleEmblemTier(streak);
            }
        }










        

    function onWorkoutCompleted() {
            if (hasRecordedCompletionForCurrentSplit) return;
            hasRecordedCompletionForCurrentSplit = true;

            // 1) Increment workouts done
            const current = getWorkoutsCompletedThisWeek();
            setWorkoutsCompletedThisWeek(current + 1);

            // 2) Advance rotation
            const currentRotation = getRotationIndex();
            setRotationIndex(currentRotation + 1);

            // 3) Rough volume estimate from avg weights
            const exerciseListEl = document.getElementById("exercise-list");
            if (exerciseListEl) {
                const weightInputs = exerciseListEl.querySelectorAll(
                    'input[type="number"][data-exercise]'
                );
                let todayVolume = 0;
                const EST_REPS_PER_EXERCISE = 30;

                weightInputs.forEach(input => {
                    const w = parseFloat(input.value || "0");
                    if (!Number.isNaN(w) && w > 0) {
                        todayVolume += w * EST_REPS_PER_EXERCISE;
                    }
                });

                if (todayVolume > 0) {
                    addTodayWeight(todayVolume);
                }
            }

            // 4) UI updates
            updateStreak();
            updateWeeklyVolumeSummary?.();
            flashDayComplete();   // ðŸ”¥ let the card animation play first

            // 5) After a short delay, show weekly goal overlay + quote
            setTimeout(() => {
                celebrateWeeklyGoalHit();      // only shows if you *just* hit the goal
                showPostWorkoutQuoteOverlay(); // or showDailyQuoteModal() if you kept that one
            }, 900); // â‰ˆ front half of your 1.6s animeBlast
        }







    function checkSplitCompletion() {
            const exerciseListEl = document.getElementById("exercise-list");
            const finisherCard = document.querySelector(".finisher-card");
            const doBtn = document.getElementById("finisher-do-btn");
            const skipBtn = document.getElementById("finisher-skip-btn");

            if (!exerciseListEl || !finisherCard || !doBtn || !skipBtn) return;

            const checkboxes = exerciseListEl.querySelectorAll('input[type="checkbox"]');
            const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);

            if (allChecked) {
                finisherCard.classList.remove("locked");
                doBtn.disabled = false;
                skipBtn.disabled = false;
                // --- Update finisher card text on unlock ---
                const titleEl = document.getElementById("finisher-title");
                const tagEl = document.getElementById("finisher-tag");
                const descEl = document.getElementById("finisher-description");
                const statusEl = document.getElementById("finisher-status");

                titleEl.textContent = "Choose Your Finisher";
                tagEl.textContent = "Unlocked";
                descEl.textContent = "Pick a category below to customize your finisher.";
                statusEl.textContent = "Select conditioning, bodyweight, pump, or recovery.";

                onWorkoutCompleted();
                
            } else {
                finisherCard.classList.add("locked");
                doBtn.disabled = true;
                skipBtn.disabled = true;
                // if they uncheck something, we don't undo the logged workout,
                // but we do keep the finisher locked until it's all done
            }
        }


    // If you have extra finisher-specific controls, they can live here:
    function initFinisherControls() {
            const finisherCard = document.getElementById("finisher-card");
            if (!finisherCard) return;

            const titleEl = document.getElementById("finisher-title");
            const tagEl = document.getElementById("finisher-tag");
            const descEl = document.getElementById("finisher-description");
            const statusEl = document.getElementById("finisher-status");
            const catButtons = document.querySelectorAll(".finisher-cat-btn");
            const diffButtons = document.querySelectorAll(".finisher-diff-btn");
            const diffContainer = document.getElementById("finisher-difficulties");
            const doBtn = document.getElementById("finisher-do-btn");
            const skipBtn = document.getElementById("finisher-skip-btn");

            if (!titleEl || !tagEl || !descEl || !statusEl || !diffContainer || !doBtn || !skipBtn) return;

            let selectedCategory = null;
            let selectedDifficulty = null;
            let currentFinisher = null;

            function clearDiffSelection() {
                diffButtons.forEach(btn => btn.classList.remove("btn-primary"));
            }

            function clearCatSelection() {
                catButtons.forEach(btn => btn.classList.remove("btn-primary"));
            }

            function selectFinisher(catKey, diffKey) {
                const cat = FINISHERS[catKey];
                if (!cat) return;

                const data = cat[diffKey];
                if (!data) return;

                currentFinisher = data;
                selectedCategory = catKey;
                selectedDifficulty = diffKey;

                titleEl.textContent = data.title;
                descEl.textContent = data.description;
                tagEl.textContent = `${catKey} â€¢ ${diffKey}`.toUpperCase();

                statusEl.textContent =
                    data.tokenReward > 0
                        ? `Complete this finisher to earn ${data.tokenReward >= 1 ? "a Rest Token" : `${data.tokenReward * 100}% of a Rest Token`}.`
                        : "Extra work for extra pride â€” no token reward on this one.";

                doBtn.disabled = false;
                skipBtn.disabled = false;
            }

            // Category buttons
            catButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    if (finisherCard.classList.contains("locked")) return;

                    const cat = btn.getAttribute("data-category");
                    if (!cat) return;

                    clearCatSelection();
                    btn.classList.add("btn-primary");

                    diffContainer.classList.remove("hidden");
                    clearDiffSelection();
                    selectedDifficulty = null;
                    currentFinisher = null;

                    titleEl.textContent = "Pick your finisher difficulty";
                    descEl.textContent = "Choose how hard you want to push today. Harder options can earn Rest Tokens.";
                    tagEl.textContent = cat.toUpperCase();
                    statusEl.textContent = "Select Easy, Standard, or Hard to lock in your finisher.";
                });
            });

            // Difficulty buttons
            diffButtons.forEach(btn => {
                btn.addEventListener("click", () => {
                    if (finisherCard.classList.contains("locked")) return;

                    const diff = btn.getAttribute("data-difficulty");
                    if (!diff) return;

                    const activeCatBtn = Array.from(catButtons).find(b => b.classList.contains("btn-primary"));
                    if (!activeCatBtn) return;

                    const cat = activeCatBtn.getAttribute("data-category");
                    clearDiffSelection();
                    btn.classList.add("btn-primary");

                    selectFinisher(cat, diff);
                });
            });

            // âœ… Mark Completed (with 1-per-day decision gate)
        doBtn.addEventListener("click", () => {
            if (!currentFinisher) return;
            if (finisherCard.classList.contains("locked")) return;

            const todayKey = getTodayDateKey();
            const lastFinisherDay = localStorage.getItem(LAST_FINISHER_DATE_KEY);

            // Already made a decision (completed or skipped) today
            if (lastFinisherDay === todayKey) {
                showToast("You already locked in todayâ€™s finisher decision. Extra work now is pure bonus. ðŸ’ª");
                return;
            }

            const ok = window.confirm("Mark this finisher as completed for today?");
            if (!ok) return;

            const reward = currentFinisher.tokenReward || 0;
            if (reward > 0) {
                addRestTokenProgress(reward);
                updateStreak();
            }

            // ðŸ”’ Lock todayâ€™s finisher decision
            localStorage.setItem(LAST_FINISHER_DATE_KEY, todayKey);

            statusEl.textContent = "Finisher completed. Nice work.";
            finisherCard.classList.add("completed-pulse");

            // Lock the card for the rest of the day
            finisherCard.classList.add("locked");
            doBtn.disabled = true;
            skipBtn.disabled = true;
            tagEl.textContent = "DONE";

            setTimeout(() => {
                finisherCard.classList.remove("completed-pulse");
            }, 800);

            celebrateFinisher?.();
        });


            // âŒ Skip for Today (with confirmation + lock)
        skipBtn.addEventListener("click", () => {
            if (finisherCard.classList.contains("locked")) return;

            const confirmSkip = window.confirm(
                "Skip todayâ€™s finisher and lock it in for the day?\n\n" +
                "You wonâ€™t be able to come back and complete it later."
            );

            // â— If they fat-fingered, this lets them back out
            if (!confirmSkip) {
                statusEl.textContent = "Finisher is still optional for today.";
                return;
            }

            const todayKey = getTodayDateKey();
            // Mark that todayâ€™s finisher decision is made (even though it was a skip)
            localStorage.setItem(LAST_FINISHER_DATE_KEY, todayKey);

            statusEl.textContent =
                "You skipped the finisher today. Main work still counts â€” come back stronger tomorrow.";
            tagEl.textContent = "SKIPPED";

            finisherCard.classList.add("locked");
            doBtn.disabled = true;
            skipBtn.disabled = true;
        });

        }



        // =============================
        // 2) SHOW SCREEN
        // =============================
        function showScreen(name) {
            const setup = document.getElementById("screen-setup");
            const daily = document.getElementById("screen-daily");
            if (!setup || !daily) {
                console.warn("screen elements not found");
                return;
            }

            if (name === "setup") {
                setup.style.display = "block";
                daily.style.display = "none";
            } else {
                setup.style.display = "none";
                daily.style.display = "block";
            }

            localStorage.setItem(LAST_SCREEN_KEY, name);
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        // =============================
        // 3) INIT SCREENS + BUTTONS
        // =============================
        function initScreens() {
            console.log("initScreens running");

            const onboarded = localStorage.getItem(ONBOARDED_KEY) === "true";
            const last = localStorage.getItem(LAST_SCREEN_KEY);

            if (!onboarded) {
                console.log("Not onboarded â†’ show setup");
                showScreen("setup");
            } else if (last === "daily" || last === "setup") {
                console.log("Onboarded, last:", last);
                showScreen(last);
            } else {
                console.log("Onboarded, no last â†’ daily");
                showScreen("daily");
            }

            // --- Start Today (top nav) ---
            const heroCta = document.getElementById("hero-cta");
            if (heroCta) {
                heroCta.addEventListener("click", () => {
                    console.log("hero-cta clicked");
                    localStorage.setItem(ONBOARDED_KEY, "true");
                    showScreen("daily");
                });
            } else {
                console.warn("hero-cta not found");
            }

            // --- Get Started (bottom bar) ---
            const bottomSplitBtn = document.getElementById("bottom-split-btn");
            if (bottomSplitBtn) {
                bottomSplitBtn.addEventListener("click", () => {
                    console.log("bottom-split-btn clicked");
                    localStorage.setItem(ONBOARDED_KEY, "true");
                    showScreen("daily");
                });
            } else {
                console.warn("bottom-split-btn not found");
            }

            // --- Setup button in nav ---
            const settingsBtn = document.getElementById("open-settings-btn");
            if (settingsBtn) {
                settingsBtn.addEventListener("click", (e) => {
                    e.preventDefault();
                    console.log("open-settings-btn clicked");
                    showScreen("setup");
                });
            } else {
                console.warn("open-settings-btn not found");
            }

            // --- Add to Home Screen button ---
            const addToHomeBtn = document.getElementById("add-to-home-btn");
            if (addToHomeBtn) {
                addToHomeBtn.addEventListener("click", () => {
                    console.log("add-to-home-btn clicked");
                    const installSection = document.getElementById("install");
                    if (installSection) {
                        installSection.scrollIntoView({ behavior: "smooth" });
                    } else {
                        console.warn("#install section not found");
                    }
                });
            } else {
                console.warn("add-to-home-btn not found");
            }
        }


    
        // --- Small toast at bottom of screen ---
            function showToast(message, timeout = 2200) {
                let container = document.getElementById("toast-container");
                if (!container) {
                    container = document.createElement("div");
                    container.id = "toast-container";
                    container.className = "toast-container";
                    document.body.appendChild(container);
                }

                const toast = document.createElement("div");
                toast.className = "toast";
                toast.textContent = message;
                container.appendChild(toast);

                setTimeout(() => {
                    toast.classList.add("out");
                    setTimeout(() => {
                        toast.remove();
                        if (!container.hasChildNodes()) {
                            container.remove();
                        }
                    }, 220);
                }, timeout);
            }

            // --- Daily completion pulse on Today's Split card ---
            function flashDayComplete() {
                const splitCard = document.querySelector("#split .workout-card");
                if (!splitCard) return;

                // reset animation if it was already applied
                splitCard.classList.remove("day-complete-boost");
                void splitCard.offsetWidth; // force reflow
                splitCard.classList.add("day-complete-boost");
            }

            // --- Finisher micro celebration ---
            function celebrateFinisher() {
                const finisherCard = document.getElementById("finisher-card");
                if (!finisherCard) return;

                finisherCard.classList.remove("finisher-celebrate");
                void finisherCard.offsetWidth;
                finisherCard.classList.add("finisher-celebrate");

                showToast("Finisher complete. Thatâ€™s extra work in the bank. ðŸ’ª");
            }
            function showPostWorkoutQuoteOverlay() {
                    const overlay = document.createElement("div");
                    overlay.className = "postworkout-overlay";

                    const quote = getRandomPostWorkoutQuote();

                    overlay.innerHTML = `
        <div class="postworkout-card">
            <h2>Workout complete ðŸ”¥</h2>
            <p class="postworkout-quote">${quote}</p>
            <p class="postworkout-hint">
                Feeling good? You can cash in a finisher for extra progress.
            </p>
            <div class="postworkout-actions">
                <button class="btn btn-primary" id="postworkout-do-finisher">
                    Do finisher
                </button>
                <button class="btn btn-outline" id="postworkout-close">
                    Close
                </button>
            </div>
        </div>
    `;

                    document.body.appendChild(overlay);

                    const closeBtn = document.getElementById("postworkout-close");
                    const finisherBtn = document.getElementById("postworkout-do-finisher");

                    if (closeBtn) {
                        closeBtn.addEventListener("click", () => {
                            overlay.remove(); // no scroll, no locking â€” they can change their mind later
                        });
                    }

                    if (finisherBtn) {
                        finisherBtn.addEventListener("click", () => {
                            overlay.remove();

                            const finisherSection =
                                document.getElementById("finisher-card") ||
                                document.getElementById("finisher-section");

                            if (finisherSection) {
                                finisherSection.scrollIntoView({
                                    behavior: "smooth",
                                    block: "center"
                                });

                                // brief highlight so they know where to look
                                finisherSection.classList.add("finisher-focus");
                                setTimeout(() => {
                                    finisherSection.classList.remove("finisher-focus");
                                }, 1000);
                            }
                        });
                    }

                    // Close by tapping outside the card
                    overlay.addEventListener("click", (e) => {
                        if (e.target === overlay) {
                            overlay.remove();
                        }
                    });
                }

    function celebrateWeeklyGoalHit() {
        const goal = getWeeklyGoal();
        const done = getWorkoutsCompletedThisWeek();

        // Only fire the moment you *hit* the goal, not on extra sessions
        if (!goal || done !== goal) return;

        // If one is already open, donâ€™t stack them
        if (document.querySelector(".weekly-overlay")) return;

        const overlay = document.createElement("div");
        overlay.className = "weekly-overlay";
        overlay.innerHTML = `
        <div class="weekly-overlay-card">
            <h2>Weekly goal hit ðŸŽ‰</h2>
            <p>You showed up for all ${goal} planned sessions. Thatâ€™s how streaks are built.</p>
            <button class="btn btn-primary" id="weekly-overlay-continue">Continue</button>
        </div>
    `;

        document.body.appendChild(overlay);

        // ðŸ”¹ Button closes the overlay
        const continueBtn = overlay.querySelector("#weekly-overlay-continue");
        if (continueBtn) {
            continueBtn.addEventListener("click", (e) => {
                e.stopPropagation(); // donâ€™t trigger the background click
                overlay.remove();
            });
        }

        // ðŸ”¹ Click outside the card also closes it
        overlay.addEventListener("click", (e) => {
            if (e.target === overlay) {
                overlay.remove();
            }
        });
    }






    // =============================
    // 8) PWA / SERVICE WORKER
    // =============================
    function initServiceWorker() {
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker
                    .register("./sw.js")
                    .then((registration) => {
                        console.log("Service worker registered:", registration.scope);
                    })
                    .catch((err) => {
                        console.log("Service worker registration failed:", err);
                    });
            });
        }
    }
    function initDebugStreakButton() {
        const btn = document.getElementById("debug-streak-plus");
        if (!btn) return;

        btn.addEventListener("click", () => {
            const current = getWeeklyStreak();
            const next = current + 1;
            setWeeklyStreak(next);

            // Update banner + aura
            updateStreak();

            // If emblem system is wired in, this will trigger rank up overlays / power-up
            if (typeof handleEmblemTier === "function") {
                handleEmblemTier(next);
            }

            showToast?.(`Debug: weekly streak is now ${next} week(s).`);
        });
    }

    // =============================
    // 9) INIT
    // =============================
    window.addEventListener("DOMContentLoaded", () => {
        ensureWeeklyState();
        resetWeeklyWeightByDay();
        updateStreak();
        initScreens();
        renderTodaySplit();
        initWeeklyGoalControls();
        initIntensitySlider();
        initFinisherControls();
        initServiceWorker();
        updateStreak();
        updateWeeklyVolumeSummary();
        initDebugStreakButton(); // ðŸ”§ DEV ONLY â€“ remove later

    });

        if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }


</script>

<!-- DEBUG ONLY: streak tester -->
<button id="debug-streak-plus" style="
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    z-index: 9999;
    padding: 0.4rem 0.8rem;
    font-size: 0.7rem;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.25);
    background: rgba(0,0,0,0.75);
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  ">
    +1 Week Streak
</button>

</body>

</html>
